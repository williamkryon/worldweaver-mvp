

==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据玩家的创意构建一个完整的 RPG 世界。

        玩家创意：
        猫猫都市

        当前 UI 语言：中文

        语言要求（非常重要）：
        - 如果 UI 语言是 "中文"，则除了 JSON 的 key（如 "title"）必须保持英文外，
        所有 value（标题、简介、地点名称与描述、角色名称与描述、initial_hook、
        world_logic 里的 culture 等等）都必须使用自然流畅的中文。
        - 如果 UI 语言是 "English"，则所有 value 都必须使用自然流畅的英文。

        请输出 JSON，字段如下：
        

        {
        "title": "...",
        "summary": "...",
        "initial_hook": "...",
        "locations": [
            {"name": "...", "description": "...", "tags": ["city","ruin"], "danger": 0-100}
        ],
        "characters": [
            {
                "name": "...",
                "role": "...",
                "short_desc": "...",
                "stats": {
                    "trust": 0-100,
                    "fear": 0-100,
                    "health": 50-120,
                    "custom": {}
                }
            }
        ],

        "world_logic": {
            "allow_magic": true/false,
            "tech_level": "stone_age | medieval | industrial | modern | sci_fi",
            "energy_system": "...",
            "physics_rules": "...",
            "culture": "...",
            "world_type": "desert | frost | volcanic | apocalypse | forest | ocean"
        },

        "initial_state": {
            "tension": 0-100,
            "magic_density": 0-100,
            "corruption": 0-100,
            "radiation": 0-100
        }
        }

        要求：
        - 输出严格 JSON
        - 不要解释
        - 内容必须与玩家的创意一致
        - initial_state 的数值必须由世界逻辑推导
        

=== GPT RAW OUTPUT ===
{
    "title": "猫猫都市",
    "summary": "在一个由猫咪统治的现代都市中，猫猫们建立了自己的文明，享受着和平与繁荣，然而暗藏的阴影正逐渐弥漫。",
    "initial_hook": "一场神秘的失踪事件让猫猫们感到不安，传言中有古老的力量在觉醒，冒险者们被召集以揭开真相。",
    "locations": [
        {
            "name": "喵星街",
            "description": "繁华的商业区，猫咪们在这里交易美食与玩具，四处都是欢快的叫声。",
            "tags": ["city"],
            "danger": 10
        },
        {
            "name": "猫咪图书馆",
            "description": "藏有无数古籍和知识的神秘地方，传说中隐藏着强大的魔法。",
            "tags": ["city", "mystery"],
            "danger": 20
        },
        {
            "name": "阴影废墟",
            "description": "曾经的繁华地带，如今却是险恶的废墟，传言中有失落的宝藏与危险的生物。",
            "tags": ["ruin"],
            "danger": 70
        }
    ],
    "characters": [
        {
            "name": "小白",
            "role": "侦探",
            "short_desc": "一只聪明机灵的白猫，擅长解谜与追踪，总是能找到线索。",
            "stats": {
                "trust": 80,
                "fear": 20,
                "health": 100,
                "custom": {}
            }
        },
        {
            "name": "黑夜",
            "role": "神秘法师",
            "short_desc": "一只神秘的黑猫，掌握古老的魔法，言行低调却充满威严。",
            "stats": {
                "trust": 50,
                "fear": 60,
                "health": 80,
                "custom": {}
            }
        }
    ],
    "world_logic": {
        "allow_magic": true,
        "tech_level": "modern",
        "energy_system": "神秘能量与现代科技共存",
        "physics_rules": "与现实相似，但魔法能改变部分物理规律",
        "culture": "猫咪文化注重友谊、交易与知识，流行各种猫咪节日。",
        "world_type": "forest"
    },
    "initial_state": {
        "tension": 30,
        "magic_density": 50,
        "corruption": 20,
        "radiation": 0
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        为这个世界写一句话主线任务（目标句子，不要剧情）。
        世界信息：
        {"title": "猫猫都市", "summary": "在一个由猫咪统治的现代都市中，猫猫们建立了自己的文明，享受着和平与繁荣，然而暗藏的阴影正逐渐弥漫。", "initial_hook": "一场神秘的失踪事件让猫猫们感到不安，传言中有古老的力量在觉醒，冒险者们被召集以揭开真相。", "locations": [{"name": "喵星街", "description": "繁华的商业区，猫咪们在这里交易美食与玩具，四处都是欢快的叫声。", "tags": ["city"], "danger": 10}, {"name": "猫咪图书馆", "description": "藏有无数古籍和知识的神秘地方，传说中隐藏着强大的魔法。", "tags": ["city", "mystery"], "danger": 20}, {"name": "阴影废墟", "description": "曾经的繁华地带，如今却是险恶的废墟，传言中有失落的宝藏与危险的生物。", "tags": ["ruin"], "danger": 70}], "characters": [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机灵的白猫，擅长解谜与追踪，总是能找到线索。", "stats": {"trust": 80, "fear": 20, "health": 100, "custom": {}}}, {"name": "黑夜", "role": "神秘法师", "short_desc": "一只神秘的黑猫，掌握古老的魔法，言行低调却充满威严。", "stats": {"trust": 50, "fear": 60, "health": 80, "custom": {}}}], "world_logic": {"allow_magic": true, "tech_level": "modern", "energy_system": "神秘能量与现代科技共存", "physics_rules": "与现实相似，但魔法能改变部分物理规律", "culture": "猫咪文化注重友谊、交易与知识，流行各种猫咪节日。", "world_type": "forest"}, "initial_state": {"tension": 30, "magic_density": 50, "corruption": 20, "radiation": 0}}
        只输出一句话。

=== GPT RAW OUTPUT ===
{"main_quest": "揭开失踪事件背后的古老力量真相，拯救猫猫都市免于即将降临的阴影。"}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据以下世界内容，为这个世界生成一个“玩家角色”（主角）。

        世界信息：
        {"title": "猫猫都市", "summary": "在一个由猫咪统治的现代都市中，猫猫们建立了自己的文明，享受着和平与繁荣，然而暗藏的阴影正逐渐弥漫。", "initial_hook": "一场神秘的失踪事件让猫猫们感到不安，传言中有古老的力量在觉醒，冒险者们被召集以揭开真相。", "locations": [{"name": "喵星街", "description": "繁华的商业区，猫咪们在这里交易美食与玩具，四处都是欢快的叫声。", "tags": ["city"], "danger": 10}, {"name": "猫咪图书馆", "description": "藏有无数古籍和知识的神秘地方，传说中隐藏着强大的魔法。", "tags": ["city", "mystery"], "danger": 20}, {"name": "阴影废墟", "description": "曾经的繁华地带，如今却是险恶的废墟，传言中有失落的宝藏与危险的生物。", "tags": ["ruin"], "danger": 70}], "characters": [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机灵的白猫，擅长解谜与追踪，总是能找到线索。", "stats": {"trust": 80, "fear": 20, "health": 100, "custom": {}}}, {"name": "黑夜", "role": "神秘法师", "short_desc": "一只神秘的黑猫，掌握古老的魔法，言行低调却充满威严。", "stats": {"trust": 50, "fear": 60, "health": 80, "custom": {}}}], "world_logic": {"allow_magic": true, "tech_level": "modern", "energy_system": "神秘能量与现代科技共存", "physics_rules": "与现实相似，但魔法能改变部分物理规律", "culture": "猫咪文化注重友谊、交易与知识，流行各种猫咪节日。", "world_type": "forest"}, "initial_state": {"tension": 30, "magic_density": 50, "corruption": 20, "radiation": 0}, "main_quest": "{\"main_quest\": \"揭开失踪事件背后的古老力量真相，拯救猫猫都市免于即将降临的阴影。\"}"}

        输出 JSON，字段如下：

        {
        "player_profile": {
            "name": "玩家名字（符合世界语言风格，用 中文）",
            "background": "玩家的身世背景（2-3句话）",
            "profession": "职业 / 角色类别",
            "role_in_world": "外来者 | 被选中者 | 探险家 | 流民 | 学者 等",
            "traits": ["2~4 个个性特质"],
            "weakness": ["1~2 个弱点"]
        },
        "player_stats": {
            "health": 100,
            "sanity": 60~120,
            "mana": 0~100,           // 如果世界逻辑 allow_magic = false 则 mana = 0
            "custom": {
                "力量": 1~10,
                "敏捷": 1~10,
                "智力": 1~10
            }
        }
        }

        要求：
        - 所有字段必须符合世界逻辑 world_logic 中的 tech_level / allow_magic / energy_system
        - 名字、描述都必须使用语言：中文
        - 只输出 JSON，不要解释
        

=== GPT RAW OUTPUT ===
{
    "player_profile": {
        "name": "月影",
        "background": "月影是一只来自偏远山区的黑猫，年轻时曾目睹父母被神秘势力掳走。她发誓要揭开真相，成为一名强大的法师，以保护她所爱的猫咪们。",
        "profession": "法师",
        "role_in_world": "被选中者",
        "traits": ["勇敢", "好奇", "智慧"],
        "weakness": ["容易相信他人", "情感脆弱"]
    },
    "player_stats": {
        "health": 90,
        "sanity": 85,
        "mana": 70,
        "custom": {
            "力量": 5,
            "敏捷": 6,
            "智力": 9
        }
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG Dungeon Master.
    Your task is to narrate scenes and present clear, meaningful choices.

    General Rules:
    - Do NOT use speaker labels ("DM:" "Player:" etc.).
    - Write short, tight narrative paragraphs (2–4 sentences).
    - Always maintain consistency with world facts and main quest.
    - Keep pacing dynamic: each round must progress the story.
    - Avoid lists except for final 3 numbered action options.
    - Never explain rules or meta-thought.
    

=== USER PROMPT ===

        Use 中文.
        Based strictly on this world:
        "在一个由猫咪统治的现代都市中，猫猫们建立了自己的文明，享受着和平与繁荣，然而暗藏的阴影正逐渐弥漫。"

        Generate the opening scene of a short adventure.
        Rules:
        - 2–4 vivid sentences, no more.
        - Must directly reference the world's summary, locations, or characters.
        - End with EXACTLY 3 action options in numbered form:
        1. ...
        2. ...
        3. ...
        

=== GPT RAW OUTPUT ===
在这座猫咪统治的现代都市中，阳光透过高楼大厦洒在繁华的“喵喵广场”上，猫咪们悠闲地享受着午后的阳光，店铺里的美味鱼干散发着诱人的香气。然而，广场的一角，一只流浪猫悄然出现，目光中流露出不安，似乎在传递着即将来临的危险。随着一阵低沉的咕噜声响起，街道的温暖气氛变得微妙而紧张。

1. 走过去询问流浪猫的故事。  
2. 继续在广场上享受美食，忽略流浪猫。  
3. 召集其他猫咪，讨论流浪猫可能带来的威胁。
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据玩家的创意构建一个完整的 RPG 世界。

        玩家创意：
        猫猫都市

        当前 UI 语言：中文

        语言要求（非常重要）：
        - 如果 UI 语言是 "中文"，则除了 JSON 的 key（如 "title"）必须保持英文外，
        所有 value（标题、简介、地点名称与描述、角色名称与描述、initial_hook、
        world_logic 里的 culture 等等）都必须使用自然流畅的中文。
        - 如果 UI 语言是 "English"，则所有 value 都必须使用自然流畅的英文。

        请输出 JSON，字段如下：
        

        {
        "title": "...",
        "summary": "...",
        "initial_hook": "...",
        "locations": [
            {"name": "...", "description": "...", "tags": ["city","ruin"], "danger": 0-100}
        ],
        "characters": [
            {
                "name": "...",
                "role": "...",
                "short_desc": "...",
                "stats": {
                    "trust": 0-100,
                    "fear": 0-100,
                    "health": 50-120,
                    "custom": {}
                }
            }
        ],

        "world_logic": {
            "allow_magic": true/false,
            "tech_level": "stone_age | medieval | industrial | modern | sci_fi",
            "energy_system": "...",
            "physics_rules": "...",
            "culture": "...",
            "world_type": "desert | frost | volcanic | apocalypse | forest | ocean"
        },

        "initial_state": {
            "tension": 0-100,
            "magic_density": 0-100,
            "corruption": 0-100,
            "radiation": 0-100
        }
        }

        要求：
        - 输出严格 JSON
        - 不要解释
        - 内容必须与玩家的创意一致
        - initial_state 的数值必须由世界逻辑推导
        

=== GPT RAW OUTPUT ===
{
    "title": "猫猫都市",
    "summary": "一个猫咪主导的都市，充满了灵动与奇幻，猫咪们在这里生活、交易、冒险。城市的每个角落都流淌着神秘的魔法气息，吸引着各地的探险者。",
    "initial_hook": "你在猫猫都市的广场上，看到一只神秘的黑猫，它向你招手，似乎有重要的任务等待你去完成。",
    "locations": [
        {
            "name": "喵喵广场",
            "description": "城市的中心，猫咪们聚集在此，分享故事与交易。广场中央有一口古老的喷泉，传说中水中蕴含神秘的力量。",
            "tags": ["city", "gathering"],
            "danger": 10
        },
        {
            "name": "猫咪图书馆",
            "description": "一个藏有古老知识的地方，书籍都由猫咪守护。来这里的冒险者可以找到神秘的魔法卷轴。",
            "tags": ["city", "library"],
            "danger": 20
        },
        {
            "name": "黑暗小巷",
            "description": "城市中阴暗的角落，猫咪们在这里交易秘密和稀有物品，但小巷里也潜藏着危险的敌人。",
            "tags": ["city", "danger"],
            "danger": 60
        }
    ],
    "characters": [
        {
            "name": "露露",
            "role": "猫咪女巫",
            "short_desc": "一只聪明的黑猫，擅长魔法，常在广场上为冒险者提供指导。",
            "stats": {
                "trust": 70,
                "fear": 30,
                "health": 80,
                "custom": {}
            }
        },
        {
            "name": "阿喵",
            "role": "商人",
            "short_desc": "一只精明的橘猫，经营着各种稀奇古怪的物品，乐于为顾客讲述交易的故事。",
            "stats": {
                "trust": 50,
                "fear": 20,
                "health": 90,
                "custom": {}
            }
        }
    ],
    "world_logic": {
        "allow_magic": true,
        "tech_level": "medieval",
        "energy_system": "魔法",
        "physics_rules": "与现实相似，但魔法可影响物理法则。",
        "culture": "猫咪崇尚自由和智慧，崇拜古老的猫神。",
        "world_type": "forest"
    },
    "initial_state": {
        "tension": 30,
        "magic_density": 70,
        "corruption": 10,
        "radiation": 0
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        为这个世界写一句话主线任务（目标句子，不要剧情）。
        世界信息：
        {"title": "猫猫都市", "summary": "一个猫咪主导的都市，充满了灵动与奇幻，猫咪们在这里生活、交易、冒险。城市的每个角落都流淌着神秘的魔法气息，吸引着各地的探险者。", "initial_hook": "你在猫猫都市的广场上，看到一只神秘的黑猫，它向你招手，似乎有重要的任务等待你去完成。", "locations": [{"name": "喵喵广场", "description": "城市的中心，猫咪们聚集在此，分享故事与交易。广场中央有一口古老的喷泉，传说中水中蕴含神秘的力量。", "tags": ["city", "gathering"], "danger": 10}, {"name": "猫咪图书馆", "description": "一个藏有古老知识的地方，书籍都由猫咪守护。来这里的冒险者可以找到神秘的魔法卷轴。", "tags": ["city", "library"], "danger": 20}, {"name": "黑暗小巷", "description": "城市中阴暗的角落，猫咪们在这里交易秘密和稀有物品，但小巷里也潜藏着危险的敌人。", "tags": ["city", "danger"], "danger": 60}], "characters": [{"name": "露露", "role": "猫咪女巫", "short_desc": "一只聪明的黑猫，擅长魔法，常在广场上为冒险者提供指导。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}}, {"name": "阿喵", "role": "商人", "short_desc": "一只精明的橘猫，经营着各种稀奇古怪的物品，乐于为顾客讲述交易的故事。", "stats": {"trust": 50, "fear": 20, "health": 90, "custom": {}}}], "world_logic": {"allow_magic": true, "tech_level": "medieval", "energy_system": "魔法", "physics_rules": "与现实相似，但魔法可影响物理法则。", "culture": "猫咪崇尚自由和智慧，崇拜古老的猫神。", "world_type": "forest"}, "initial_state": {"tension": 30, "magic_density": 70, "corruption": 10, "radiation": 0}}
        只输出一句话。

=== GPT RAW OUTPUT ===
{"main_quest": "寻找黑猫的秘密，解锁猫猫都市隐藏的魔法力量。" }
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据以下世界内容，为这个世界生成一个“玩家角色”（主角）。

        世界信息：
        {"title": "猫猫都市", "summary": "一个猫咪主导的都市，充满了灵动与奇幻，猫咪们在这里生活、交易、冒险。城市的每个角落都流淌着神秘的魔法气息，吸引着各地的探险者。", "initial_hook": "你在猫猫都市的广场上，看到一只神秘的黑猫，它向你招手，似乎有重要的任务等待你去完成。", "locations": [{"name": "喵喵广场", "description": "城市的中心，猫咪们聚集在此，分享故事与交易。广场中央有一口古老的喷泉，传说中水中蕴含神秘的力量。", "tags": ["city", "gathering"], "danger": 10}, {"name": "猫咪图书馆", "description": "一个藏有古老知识的地方，书籍都由猫咪守护。来这里的冒险者可以找到神秘的魔法卷轴。", "tags": ["city", "library"], "danger": 20}, {"name": "黑暗小巷", "description": "城市中阴暗的角落，猫咪们在这里交易秘密和稀有物品，但小巷里也潜藏着危险的敌人。", "tags": ["city", "danger"], "danger": 60}], "characters": [{"name": "露露", "role": "猫咪女巫", "short_desc": "一只聪明的黑猫，擅长魔法，常在广场上为冒险者提供指导。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}}, {"name": "阿喵", "role": "商人", "short_desc": "一只精明的橘猫，经营着各种稀奇古怪的物品，乐于为顾客讲述交易的故事。", "stats": {"trust": 50, "fear": 20, "health": 90, "custom": {}}}], "world_logic": {"allow_magic": true, "tech_level": "medieval", "energy_system": "魔法", "physics_rules": "与现实相似，但魔法可影响物理法则。", "culture": "猫咪崇尚自由和智慧，崇拜古老的猫神。", "world_type": "forest"}, "initial_state": {"tension": 30, "magic_density": 70, "corruption": 10, "radiation": 0}, "main_quest": "{\"main_quest\": \"寻找黑猫的秘密，解锁猫猫都市隐藏的魔法力量。\" }"}

        输出 JSON，字段如下：

        {
        "player_profile": {
            "name": "玩家名字（符合世界语言风格，用 中文）",
            "background": "玩家的身世背景（2-3句话）",
            "profession": "职业 / 角色类别",
            "role_in_world": "外来者 | 被选中者 | 探险家 | 流民 | 学者 等",
            "traits": ["2~4 个个性特质"],
            "weakness": ["1~2 个弱点"]
        },
        "player_stats": {
            "health": 100,
            "sanity": 60~120,
            "mana": 0~100,           // 如果世界逻辑 allow_magic = false 则 mana = 0
            "custom": {
                "力量": 1~10,
                "敏捷": 1~10,
                "智力": 1~10
            }
        }
        }

        要求：
        - 所有字段必须符合世界逻辑 world_logic 中的 tech_level / allow_magic / energy_system
        - 名字、描述都必须使用语言：中文
        - 只输出 JSON，不要解释
        

=== GPT RAW OUTPUT ===
{
    "player_profile": {
        "name": "小白",
        "background": "小白是一位来自远方村庄的年轻猫咪，追寻梦想来到猫猫都市。他渴望揭开魔法的秘密，探索未知的冒险。",
        "profession": "冒险者",
        "role_in_world": "外来者",
        "traits": ["好奇", "勇敢", "机智"],
        "weakness": ["冲动", "缺乏经验"]
    },
    "player_stats": {
        "health": 100,
        "sanity": 80,
        "mana": 50,
        "custom": {
            "力量": 6,
            "敏捷": 7,
            "智力": 5
        }
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG Dungeon Master.
    Your task is to narrate scenes and present clear, meaningful choices.

    General Rules:
    - Do NOT use speaker labels ("DM:" "Player:" etc.).
    - Write short, tight narrative paragraphs (2–4 sentences).
    - Always maintain consistency with world facts and main quest.
    - Keep pacing dynamic: each round must progress the story.
    - Avoid lists except for final 3 numbered action options.
    - Never explain rules or meta-thought.
    

=== USER PROMPT ===

        Use 中文.
        Based strictly on this world:
        "一个猫咪主导的都市，充满了灵动与奇幻，猫咪们在这里生活、交易、冒险。城市的每个角落都流淌着神秘的魔法气息，吸引着各地的探险者。"

        Generate the opening scene of a short adventure.
        Rules:
        - 2–4 vivid sentences, no more.
        - Must directly reference the world's summary, locations, or characters.
        - End with EXACTLY 3 action options in numbered form:
        1. ...
        2. ...
        3. ...
        

=== GPT RAW OUTPUT ===
在这座猫咪主导的都市中，晨光透过高耸的屋顶洒在五彩斑斓的街道上，猫咪们在市场中嬉闹，交易着奇特的魔法物品。你正走在通往神秘“猫咪议会”的小巷中，巷子里的墙壁上绘满了传说中的灵动符文，似乎在低声呼唤着你。就在这时，你注意到一只眼神犀利的猫咪，正在暗处静静地观察着你，似乎有着重要的任务等待着你的参与。

1. 接近那只猫咪，询问它的意图。
2. 继续前往“猫咪议会”，忽视猫咪的注视。
3. 在市场中寻找其他冒险者，寻求合作。
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：接近那只猫咪，询问它的意图。
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "猫咪",
    "intent": "询问",
    "topic": "意图",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 猫咪
            intent: 询问
            topic: 意图
            risk: low
            完整解析：{"action_type": "social", "target": "猫咪", "intent": "询问", "topic": "意图", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 28, "magic_density": 72, "corruption": 8, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 80, "mana": 50, "custom": {"力量": 6, "敏捷": 7, "智力": 5}}

            ==================== 主要角色状态 ====================
            [{"name": "露露", "role": "猫咪女巫", "short_desc": "一只聪明的黑猫，擅长魔法，常在广场上为冒险者提供指导。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}}, {"name": "阿喵", "role": "商人", "short_desc": "一只精明的橘猫，经营着各种稀奇古怪的物品，乐于为顾客讲述交易的故事。", "stats": {"trust": 50, "fear": 20, "health": 90, "custom": {}}}]

            ==================== 玩家原始输入 ====================
            "接近那只猫咪，询问它的意图。"

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你接近那只猫咪，询问它对当前局势的意图。露露的眼神闪烁，似乎对你的问题有所保留，但最终回应道她正监视着某个神秘的威胁。气氛微微紧张，她的声音中带有一丝警觉。",
    "options": ["继续询问露露的具体威胁", "转向阿喵询问更多信息", "观察周围寻找其他线索"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": [{"name": "露露", "stats": {"trust": 75, "fear": 30}}]
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续询问露露的具体威胁
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "露露",
    "intent": "询问",
    "topic": "具体威胁",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 露露
            intent: 询问
            topic: 具体威胁
            risk: low
            完整解析：{"action_type": "social", "target": "露露", "intent": "询问", "topic": "具体威胁", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 31, "magic_density": 71, "corruption": 9, "radiation": 2}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 80, "mana": 50, "custom": {"力量": 6, "敏捷": 7, "智力": 5}}

            ==================== 主要角色状态 ====================
            [{"name": "露露", "role": "猫咪女巫", "short_desc": "一只聪明的黑猫，擅长魔法，常在广场上为冒险者提供指导。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}}, {"name": "阿喵", "role": "商人", "short_desc": "一只精明的橘猫，经营着各种稀奇古怪的物品，乐于为顾客讲述交易的故事。", "stats": {"trust": 50, "fear": 20, "health": 90, "custom": {}}}]

            ==================== 玩家原始输入 ====================
            "继续询问露露的具体威胁"

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你向露露询问具体的威胁，露露的眼神变得严肃，她告诉你最近有些神秘的黑影在附近游荡，可能会对无防备的冒险者构成威胁。她建议你保持警惕，并提供了一些关于黑影的线索。",
    "options": ["继续询问露露的其他线索", "离开与露露交谈", "寻找其他角色获取信息"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": [{"name": "露露", "stats": {"trust": 75}}]
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续询问露露的其他线索
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "露露",
    "intent": "询问",
    "topic": "线索",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 露露
            intent: 询问
            topic: 线索
            risk: low
            完整解析：{"action_type": "social", "target": "露露", "intent": "询问", "topic": "线索", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 34, "magic_density": 73, "corruption": 10, "radiation": 2}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 80, "mana": 50, "custom": {"力量": 6, "敏捷": 7, "智力": 5}}

            ==================== 主要角色状态 ====================
            [{"name": "露露", "role": "猫咪女巫", "short_desc": "一只聪明的黑猫，擅长魔法，常在广场上为冒险者提供指导。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}}, {"name": "阿喵", "role": "商人", "short_desc": "一只精明的橘猫，经营着各种稀奇古怪的物品，乐于为顾客讲述交易的故事。", "stats": {"trust": 50, "fear": 20, "health": 90, "custom": {}}}]

            ==================== 玩家原始输入 ====================
            "继续询问露露的其他线索"

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你向露露询问更多线索，她露出思考的神情，随后告诉你她最近发现了一些奇怪的符号，这些符号可能与失踪的冒险者有关。露露的情绪变得更加严肃，似乎意识到情况的严重性。",
    "options": ["继续询问符号的具体位置", "询问露露对失踪冒险者的看法", "感谢露露并继续探索"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": [{"name": "露露", "stats": {"trust": 75, "fear": 30}}]
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：询问露露对失踪冒险者的看法
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "露露",
    "intent": "询问",
    "topic": "失踪冒险者",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 露露
            intent: 询问
            topic: 失踪冒险者
            risk: low
            完整解析：{"action_type": "social", "target": "露露", "intent": "询问", "topic": "失踪冒险者", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 34, "magic_density": 72, "corruption": 8, "radiation": 2}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 80, "mana": 50, "custom": {"力量": 6, "敏捷": 7, "智力": 5}}

            ==================== 主要角色状态 ====================
            [{"name": "露露", "role": "猫咪女巫", "short_desc": "一只聪明的黑猫，擅长魔法，常在广场上为冒险者提供指导。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}}, {"name": "阿喵", "role": "商人", "short_desc": "一只精明的橘猫，经营着各种稀奇古怪的物品，乐于为顾客讲述交易的故事。", "stats": {"trust": 50, "fear": 20, "health": 90, "custom": {}}}]

            ==================== 玩家原始输入 ====================
            "询问露露对失踪冒险者的看法"

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你走到露露面前，询问她对失踪冒险者的看法。露露的眼神中闪过一丝忧虑，她缓缓说道，听说最近有几位冒险者在森林中失踪，似乎与一股神秘的力量有关。她建议你们一起调查这个事件，可能会发现一些线索。",
    "options": ["继续询问露露更多细节", "决定和露露一起去调查失踪冒险者", "询问阿喵是否知道其他消息"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": [{"name": "露露", "stats": {"trust": 75, "fear": 30}}]
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据玩家的创意构建一个完整的 RPG 世界。

        玩家创意：
        猫猫都市

        当前 UI 语言：中文

        语言要求（非常重要）：
        - 如果 UI 语言是 "中文"，则除了 JSON 的 key（如 "title"）必须保持英文外，
        所有 value（标题、简介、地点名称与描述、角色名称与描述、initial_hook、
        world_logic 里的 culture 等等）都必须使用自然流畅的中文。
        - 如果 UI 语言是 "English"，则所有 value 都必须使用自然流畅的英文。

        请输出 JSON，字段如下：
        

        {
        "title": "...",
        "summary": "...",
        "initial_hook": "...",
        "locations": [
            {"name": "...", "description": "...", "tags": ["city","ruin"], "danger": 0-100}
        ],
        "characters": [
            {
                "name": "...",
                "role": "...",
                "short_desc": "...",
                "stats": {
                    "trust": 0-100,
                    "fear": 0-100,
                    "health": 50-120,
                    "custom": {}
                }
            }
        ],

        "world_logic": {
            "allow_magic": true/false,
            "tech_level": "stone_age | medieval | industrial | modern | sci_fi",
            "energy_system": "...",
            "physics_rules": "...",
            "culture": "...",
            "world_type": "desert | frost | volcanic | apocalypse | forest | ocean"
        },

        "initial_state": {
            "tension": 0-100,
            "magic_density": 0-100,
            "corruption": 0-100,
            "radiation": 0-100
        }
        }

        要求：
        - 输出严格 JSON
        - 不要解释
        - 内容必须与玩家的创意一致
        - initial_state 的数值必须由世界逻辑推导
        

=== GPT RAW OUTPUT ===
{
    "title": "猫猫都市",
    "summary": "在一个由猫咪统治的城市中，居民们以独特的方式生活。这里有充满诱惑的市场、神秘的巫师和悠闲的阳光街道。",
    "initial_hook": "玩家们在猫猫都市的广场上偶然发现了一封神秘的信件，信中预示着即将到来的巨大危机。",
    "locations": [
        {
            "name": "肉球市场",
            "description": "这里是猫咪们交易美食与玩具的热闹集市，充满了各种诱人的气味和声音。",
            "tags": ["city", "market"],
            "danger": 20
        },
        {
            "name": "毛发神殿",
            "description": "一个神秘的地方，传说中猫神的力量在此聚集，很多猫咪来此寻求祝福。",
            "tags": ["city", "temple"],
            "danger": 50
        },
        {
            "name": "废弃的猫窝",
            "description": "一个荒废的区域，曾经是猫咪的栖息地，现在弥漫着神秘的气息，潜藏着未知的危险。",
            "tags": ["ruin", "danger"],
            "danger": 80
        }
    ],
    "characters": [
        {
            "name": "小橘",
            "role": "市集商贩",
            "short_desc": "一只热情的橘猫，擅长讲故事和做美味的零食。",
            "stats": {
                "trust": 70,
                "fear": 30,
                "health": 80,
                "custom": {}
            }
        },
        {
            "name": "灰影",
            "role": "巫师",
            "short_desc": "神秘的灰色猫咪，擅长使用魔法，知晓许多古老的秘密。",
            "stats": {
                "trust": 50,
                "fear": 70,
                "health": 60,
                "custom": {}
            }
        }
    ],
    "world_logic": {
        "allow_magic": true,
        "tech_level": "medieval",
        "energy_system": "食物与魔法",
        "physics_rules": "重力正常，魔法可改变部分物理法则",
        "culture": "猫咪崇尚自由与舒适，和平共处，崇拜猫神。",
        "world_type": "forest"
    },
    "initial_state": {
        "tension": 30,
        "magic_density": 60,
        "corruption": 10,
        "radiation": 0
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        为这个世界写一句话主线任务（目标句子，不要剧情）。
        世界信息：
        {"title": "猫猫都市", "summary": "在一个由猫咪统治的城市中，居民们以独特的方式生活。这里有充满诱惑的市场、神秘的巫师和悠闲的阳光街道。", "initial_hook": "玩家们在猫猫都市的广场上偶然发现了一封神秘的信件，信中预示着即将到来的巨大危机。", "locations": [{"name": "肉球市场", "description": "这里是猫咪们交易美食与玩具的热闹集市，充满了各种诱人的气味和声音。", "tags": ["city", "market"], "danger": 20}, {"name": "毛发神殿", "description": "一个神秘的地方，传说中猫神的力量在此聚集，很多猫咪来此寻求祝福。", "tags": ["city", "temple"], "danger": 50}, {"name": "废弃的猫窝", "description": "一个荒废的区域，曾经是猫咪的栖息地，现在弥漫着神秘的气息，潜藏着未知的危险。", "tags": ["ruin", "danger"], "danger": 80}], "characters": [{"name": "小橘", "role": "市集商贩", "short_desc": "一只热情的橘猫，擅长讲故事和做美味的零食。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}}, {"name": "灰影", "role": "巫师", "short_desc": "神秘的灰色猫咪，擅长使用魔法，知晓许多古老的秘密。", "stats": {"trust": 50, "fear": 70, "health": 60, "custom": {}}}], "world_logic": {"allow_magic": true, "tech_level": "medieval", "energy_system": "食物与魔法", "physics_rules": "重力正常，魔法可改变部分物理法则", "culture": "猫咪崇尚自由与舒适，和平共处，崇拜猫神。", "world_type": "forest"}, "initial_state": {"tension": 30, "magic_density": 60, "corruption": 10, "radiation": 0}}
        只输出一句话。

=== GPT RAW OUTPUT ===
{"main_quest":"阻止即将降临的危机，解开猫猫都市隐藏的秘密和古老的预言。"}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据以下世界内容，为这个世界生成一个“玩家角色”（主角）。

        世界信息：
        {"title": "猫猫都市", "summary": "在一个由猫咪统治的城市中，居民们以独特的方式生活。这里有充满诱惑的市场、神秘的巫师和悠闲的阳光街道。", "initial_hook": "玩家们在猫猫都市的广场上偶然发现了一封神秘的信件，信中预示着即将到来的巨大危机。", "locations": [{"name": "肉球市场", "description": "这里是猫咪们交易美食与玩具的热闹集市，充满了各种诱人的气味和声音。", "tags": ["city", "market"], "danger": 20}, {"name": "毛发神殿", "description": "一个神秘的地方，传说中猫神的力量在此聚集，很多猫咪来此寻求祝福。", "tags": ["city", "temple"], "danger": 50}, {"name": "废弃的猫窝", "description": "一个荒废的区域，曾经是猫咪的栖息地，现在弥漫着神秘的气息，潜藏着未知的危险。", "tags": ["ruin", "danger"], "danger": 80}], "characters": [{"name": "小橘", "role": "市集商贩", "short_desc": "一只热情的橘猫，擅长讲故事和做美味的零食。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}}, {"name": "灰影", "role": "巫师", "short_desc": "神秘的灰色猫咪，擅长使用魔法，知晓许多古老的秘密。", "stats": {"trust": 50, "fear": 70, "health": 60, "custom": {}}}], "world_logic": {"allow_magic": true, "tech_level": "medieval", "energy_system": "食物与魔法", "physics_rules": "重力正常，魔法可改变部分物理法则", "culture": "猫咪崇尚自由与舒适，和平共处，崇拜猫神。", "world_type": "forest"}, "initial_state": {"tension": 30, "magic_density": 60, "corruption": 10, "radiation": 0}, "main_quest": "{\"main_quest\":\"阻止即将降临的危机，解开猫猫都市隐藏的秘密和古老的预言。\"}"}

        输出 JSON，字段如下：

        {
        "player_profile": {
            "name": "玩家名字（符合世界语言风格，用 中文）",
            "background": "玩家的身世背景（2-3句话）",
            "profession": "职业 / 角色类别",
            "role_in_world": "外来者 | 被选中者 | 探险家 | 流民 | 学者 等",
            "traits": ["2~4 个个性特质"],
            "weakness": ["1~2 个弱点"]
        },
        "player_stats": {
            "health": 100,
            "sanity": 60~120,
            "mana": 0~100,           // 如果世界逻辑 allow_magic = false 则 mana = 0
            "custom": {
                "力量": 1~10,
                "敏捷": 1~10,
                "智力": 1~10
            }
        }
        }

        要求：
        - 所有字段必须符合世界逻辑 world_logic 中的 tech_level / allow_magic / energy_system
        - 名字、描述都必须使用语言：中文
        - 只输出 JSON，不要解释
        

=== GPT RAW OUTPUT ===
{
    "player_profile": {
        "name": "小白",
        "background": "小白是一只从遥远森林而来的白猫，渴望探索猫猫都市的魅力与秘密。她的身世神秘，传说中她与猫神有着特殊的联系。",
        "profession": "探索者",
        "role_in_world": "被选中者",
        "traits": ["好奇心强", "勇敢无畏", "善于交际"],
        "weakness": ["对魔法敏感", "容易信任他人"]
    },
    "player_stats": {
        "health": 100,
        "sanity": 85,
        "mana": 50,
        "custom": {
            "力量": 6,
            "敏捷": 8,
            "智力": 7
        }
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG Dungeon Master.
    Your task is to narrate scenes and present clear, meaningful choices.

    General Rules:
    - Do NOT use speaker labels ("DM:" "Player:" etc.).
    - Write short, tight narrative paragraphs (2–4 sentences).
    - Always maintain consistency with world facts and main quest.
    - Keep pacing dynamic: each round must progress the story.
    - Avoid lists except for final 3 numbered action options.
    - Never explain rules or meta-thought.
    

=== USER PROMPT ===

        Use 中文.
        Based strictly on this world:
        "在一个由猫咪统治的城市中，居民们以独特的方式生活。这里有充满诱惑的市场、神秘的巫师和悠闲的阳光街道。"

        Generate the opening scene of a short adventure.
        Rules:
        - 2–4 vivid sentences, no more.
        - Must directly reference the world's summary, locations, or characters.
        - End with EXACTLY 3 action options in numbered form:
        1. ...
        2. ...
        3. ...
        

=== GPT RAW OUTPUT ===
阳光透过猫咪统治的城市的街道洒下温暖的光芒，居民们在市场上忙碌，交易着各式各样的奇特物品。在一个角落里，一位神秘的巫师正在展示他的最新魔法，周围围满了好奇的猫咪和人类。突然，一声尖锐的叫声打破了宁静，所有的目光都转向了市场中心，那里发生了一起激烈的争吵。  

1. 前往市场中心调查争吵的原因。  
2. 与巫师交谈，询问他展示的魔法。  
3. 在市场中浏览，寻找有趣的物品。
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：与巫师交谈，询问他展示的魔法。  
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "巫师",
    "intent": "询问",
    "topic": "魔法",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 巫师
            intent: 询问
            topic: 魔法
            risk: low
            完整解析：{"action_type": "social", "target": "巫师", "intent": "询问", "topic": "魔法", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 29, "magic_density": 61, "corruption": 12, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 85, "mana": 50, "custom": {"力量": 6, "敏捷": 8, "智力": 7}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小橘", "role": "市集商贩", "short_desc": "一只热情的橘猫，擅长讲故事和做美味的零食。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "灰影", "role": "巫师", "short_desc": "神秘的灰色猫咪，擅长使用魔法，知晓许多古老的秘密。", "stats": {"trust": 50, "fear": 70, "health": 60, "custom": {}}, "personality": {"traits": ["理性", "神秘"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "与巫师交谈，询问他展示的魔法。  "

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你走近巫师，询问他关于魔法的知识。他微微一笑，用平淡的语气开始解释一些古老的咒语和施法技巧，眼中流露出神秘的光芒。你能够感受到他对魔法的热情，仿佛将你带入了一个更深的世界。",
    "options": ["继续询问魔法的具体应用", "询问巫师的过去", "请求巫师展示一个简单的魔法"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续询问魔法的具体应用
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "魔法",
    "intent": "询问",
    "topic": "具体应用",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 魔法
            intent: 询问
            topic: 具体应用
            risk: low
            完整解析：{"action_type": "social", "target": "魔法", "intent": "询问", "topic": "具体应用", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 27, "magic_density": 60, "corruption": 10, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 85, "mana": 50, "custom": {"力量": 6, "敏捷": 8, "智力": 7}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小橘", "role": "市集商贩", "short_desc": "一只热情的橘猫，擅长讲故事和做美味的零食。", "stats": {"trust": 70, "fear": 30, "health": 80, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "灰影", "role": "巫师", "short_desc": "神秘的灰色猫咪，擅长使用魔法，知晓许多古老的秘密。", "stats": {"trust": 50, "fear": 70, "health": 60, "custom": {}}, "personality": {"traits": ["理性", "神秘"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续询问魔法的具体应用"

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你走向灰影，询问关于魔法的具体应用。灰影听后微微一笑，开始讲述几种魔法在实际生活中的应用，如治愈、隐身和元素操控。他的声音平淡，却透出一种神秘感，让你感到对魔法的理解更加深入。",
    "options": ["继续询问其他魔法应用", "尝试展示你对魔法的理解", "离开与灰影的对话"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据玩家的创意构建一个完整的 RPG 世界。

        玩家创意：
        猫猫都市

        当前 UI 语言：中文

        语言要求（非常重要）：
        - 如果 UI 语言是 "中文"，则除了 JSON 的 key（如 "title"）必须保持英文外，
        所有 value（标题、简介、地点名称与描述、角色名称与描述、initial_hook、
        world_logic 里的 culture 等等）都必须使用自然流畅的中文。
        - 如果 UI 语言是 "English"，则所有 value 都必须使用自然流畅的英文。

        请输出 JSON，字段如下：
        

        {
        "title": "...",
        "summary": "...",
        "initial_hook": "...",
        "locations": [
            {"name": "...", "description": "...", "tags": ["city","ruin"], "danger": 0-100}
        ],
        "characters": [
            {
                "name": "...",
                "role": "...",
                "short_desc": "...",
                "stats": {
                    "trust": 0-100,
                    "fear": 0-100,
                    "health": 50-120,
                    "custom": {}
                }
            }
        ],

        "world_logic": {
            "allow_magic": true/false,
            "tech_level": "stone_age | medieval | industrial | modern | sci_fi",
            "energy_system": "...",
            "physics_rules": "...",
            "culture": "...",
            "world_type": "desert | frost | volcanic | apocalypse | forest | ocean"
        },

        "initial_state": {
            "tension": 0-100,
            "magic_density": 0-100,
            "corruption": 0-100,
            "radiation": 0-100
        }
        }

        要求：
        - 输出严格 JSON
        - 不要解释
        - 内容必须与玩家的创意一致
        - initial_state 的数值必须由世界逻辑推导
        

=== GPT RAW OUTPUT ===
{
    "title": "猫猫都市",
    "summary": "在一个由猫咪主宰的城市，猫族和平共处，追求幸福与懒散的生活。这里的市民们以奇妙的方式运用智慧和猫咪特有的技巧，创造出独特的文化和科技。",
    "initial_hook": "一场神秘的失踪事件打破了城市的宁静，猫咪们开始探寻真相，揭开隐藏在城市深处的秘密。",
    "locations": [
        {
            "name": "猫咪广场",
            "description": "城市的中心，铺满阳光照射的石板路，常常举办各种庆典和聚会。",
            "tags": ["city", "gathering"],
            "danger": 10
        },
        {
            "name": "昏暗巷道",
            "description": "一条狭窄且阴暗的小巷，藏匿着秘密和阴影，流传着许多关于猫咪的传说。",
            "tags": ["city", "danger"],
            "danger": 60
        },
        {
            "name": "废弃工厂",
            "description": "曾经繁忙的工厂如今只剩下破败的机器，传闻有猫咪在这里进行危险的实验。",
            "tags": ["ruin", "danger"],
            "danger": 80
        }
    ],
    "characters": [
        {
            "name": "小白",
            "role": "侦探",
            "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。",
            "stats": {
                "trust": 70,
                "fear": 20,
                "health": 90,
                "custom": {}
            }
        },
        {
            "name": "黑夜",
            "role": "神秘商人",
            "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。",
            "stats": {
                "trust": 30,
                "fear": 60,
                "health": 80,
                "custom": {}
            }
        },
        {
            "name": "喵星人",
            "role": "科学家",
            "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。",
            "stats": {
                "trust": 90,
                "fear": 10,
                "health": 100,
                "custom": {}
            }
        }
    ],
    "world_logic": {
        "allow_magic": false,
        "tech_level": "modern",
        "energy_system": "可再生能源",
        "physics_rules": "基于现实物理",
        "culture": "猫咪崇尚自由与友好，强调社区和团结。",
        "world_type": "urban"
    },
    "initial_state": {
        "tension": 40,
        "magic_density": 0,
        "corruption": 20,
        "radiation": 0
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        为这个世界写一句话主线任务（目标句子，不要剧情）。
        世界信息：
        {"title": "猫猫都市", "summary": "在一个由猫咪主宰的城市，猫族和平共处，追求幸福与懒散的生活。这里的市民们以奇妙的方式运用智慧和猫咪特有的技巧，创造出独特的文化和科技。", "initial_hook": "一场神秘的失踪事件打破了城市的宁静，猫咪们开始探寻真相，揭开隐藏在城市深处的秘密。", "locations": [{"name": "猫咪广场", "description": "城市的中心，铺满阳光照射的石板路，常常举办各种庆典和聚会。", "tags": ["city", "gathering"], "danger": 10}, {"name": "昏暗巷道", "description": "一条狭窄且阴暗的小巷，藏匿着秘密和阴影，流传着许多关于猫咪的传说。", "tags": ["city", "danger"], "danger": 60}, {"name": "废弃工厂", "description": "曾经繁忙的工厂如今只剩下破败的机器，传闻有猫咪在这里进行危险的实验。", "tags": ["ruin", "danger"], "danger": 80}], "characters": [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}}], "world_logic": {"allow_magic": false, "tech_level": "modern", "energy_system": "可再生能源", "physics_rules": "基于现实物理", "culture": "猫咪崇尚自由与友好，强调社区和团结。", "world_type": "urban"}, "initial_state": {"tension": 40, "magic_density": 0, "corruption": 20, "radiation": 0}}
        只输出一句话。

=== GPT RAW OUTPUT ===
{"main_quest": "揭开猫猫都市失踪事件的真相，恢复城市的和平与幸福。" }
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据以下世界内容，为这个世界生成一个“玩家角色”（主角）。

        世界信息：
        {"title": "猫猫都市", "summary": "在一个由猫咪主宰的城市，猫族和平共处，追求幸福与懒散的生活。这里的市民们以奇妙的方式运用智慧和猫咪特有的技巧，创造出独特的文化和科技。", "initial_hook": "一场神秘的失踪事件打破了城市的宁静，猫咪们开始探寻真相，揭开隐藏在城市深处的秘密。", "locations": [{"name": "猫咪广场", "description": "城市的中心，铺满阳光照射的石板路，常常举办各种庆典和聚会。", "tags": ["city", "gathering"], "danger": 10}, {"name": "昏暗巷道", "description": "一条狭窄且阴暗的小巷，藏匿着秘密和阴影，流传着许多关于猫咪的传说。", "tags": ["city", "danger"], "danger": 60}, {"name": "废弃工厂", "description": "曾经繁忙的工厂如今只剩下破败的机器，传闻有猫咪在这里进行危险的实验。", "tags": ["ruin", "danger"], "danger": 80}], "characters": [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}}], "world_logic": {"allow_magic": false, "tech_level": "modern", "energy_system": "可再生能源", "physics_rules": "基于现实物理", "culture": "猫咪崇尚自由与友好，强调社区和团结。", "world_type": "urban"}, "initial_state": {"tension": 40, "magic_density": 0, "corruption": 20, "radiation": 0}, "main_quest": "{\"main_quest\": \"揭开猫猫都市失踪事件的真相，恢复城市的和平与幸福。\" }"}

        输出 JSON，字段如下：

        {
        "player_profile": {
            "name": "玩家名字（符合世界语言风格，用 中文）",
            "background": "玩家的身世背景（2-3句话）",
            "profession": "职业 / 角色类别",
            "role_in_world": "外来者 | 被选中者 | 探险家 | 流民 | 学者 等",
            "traits": ["2~4 个个性特质"],
            "weakness": ["1~2 个弱点"]
        },
        "player_stats": {
            "health": 100,
            "sanity": 60~120,
            "mana": 0~100,           // 如果世界逻辑 allow_magic = false 则 mana = 0
            "custom": {
                "力量": 1~10,
                "敏捷": 1~10,
                "智力": 1~10
            }
        }
        }

        要求：
        - 所有字段必须符合世界逻辑 world_logic 中的 tech_level / allow_magic / energy_system
        - 名字、描述都必须使用语言：中文
        - 只输出 JSON，不要解释
        

=== GPT RAW OUTPUT ===
{
    "player_profile": {
        "name": "小黑",
        "background": "小黑是一只在猫猫都市长大的街头猫，习惯了独自生活与解决问题。经历过城市的黑暗面，他渴望找到失踪事件的真相，恢复家园的安宁。",
        "profession": "侦探",
        "role_in_world": "探险家",
        "traits": ["机智", "独立", "观察力强"],
        "weakness": ["缺乏信任", "害怕失去"]
    },
    "player_stats": {
        "health": 100,
        "sanity": 90,
        "mana": 0,
        "custom": {
            "力量": 6,
            "敏捷": 8,
            "智力": 9
        }
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG Dungeon Master.
    Your task is to narrate scenes and present clear, meaningful choices.

    General Rules:
    - Do NOT use speaker labels ("DM:" "Player:" etc.).
    - Write short, tight narrative paragraphs (2–4 sentences).
    - Always maintain consistency with world facts and main quest.
    - Keep pacing dynamic: each round must progress the story.
    - Avoid lists except for final 3 numbered action options.
    - Never explain rules or meta-thought.
    

=== USER PROMPT ===

        Use 中文.
        Based strictly on this world:
        "在一个由猫咪主宰的城市，猫族和平共处，追求幸福与懒散的生活。这里的市民们以奇妙的方式运用智慧和猫咪特有的技巧，创造出独特的文化和科技。"

        Generate the opening scene of a short adventure.
        Rules:
        - 2–4 vivid sentences, no more.
        - Must directly reference the world's summary, locations, or characters.
        - End with EXACTLY 3 action options in numbered form:
        1. ...
        2. ...
        3. ...
        

=== GPT RAW OUTPUT ===
在猫咪主宰的城市中心，一个阳光明媚的下午，街道上飘荡着鱼香和草的气息，市民们悠闲地享受着生活。你走过一座华丽的猫咪雕像，耳边听到一只老猫正在低声讲述古老的传说，吸引了一群好奇的年轻猫咪围坐在旁。就在这时，传来一声急促的喵叫，打断了宁静，似乎是来自不远处的市集。 

1. 前往市集查看发生了什么事。  
2. 静静地观察老猫，倾听更多的故事。  
3. 找个地方休息，享受这宁静的下午。
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：前往市集查看发生了什么事。  
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "市集",
    "intent": "调查",
    "topic": "发生的事情",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 市集
            intent: 调查
            topic: 发生的事情
            risk: low
            完整解析：{"action_type": "exploration", "target": "市集", "intent": "调查", "topic": "发生的事情", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 39, "magic_density": 0, "corruption": 20, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "前往市集查看发生了什么事。  "

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：shallow

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：0 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你在市集上观察到一些异常的活动，周围的商贩们似乎互相低声交谈，神情紧张。你发现地面上有几处被踩踏过的痕迹，似乎刚刚发生过什么事情。听到一位商贩提到最近失踪的猫咪，你感到事情并不简单。",
  "options": [
    "继续调查痕迹",
    "询问商贩关于失踪猫咪的更多信息",
    "观察周围商贩的互动"
  ],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：询问商贩关于失踪猫咪的更多信息
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "商贩",
    "intent": "询问",
    "topic": "失踪猫咪",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 商贩
            intent: 询问
            topic: 失踪猫咪
            risk: low
            完整解析：{"action_type": "social", "target": "商贩", "intent": "询问", "topic": "失踪猫咪", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 42, "magic_density": 2, "corruption": 20, "radiation": 3}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "询问商贩关于失踪猫咪的更多信息"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：shallow

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：0 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（social）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你走到黑夜身边，询问他关于失踪猫咪的事情。他微微皱眉，似乎在考虑如何回答。\"我听说，有人最后看到它在老街附近徘徊，但具体的情况我就不太清楚了，你最好小心些，那地方最近有些不太对劲。\"",
    "options": ["进一步询问商贩", "前往老街调查", "询问其他 NPC"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": [{"name": "黑夜", "trust": 25, "fear": 60}]
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：前往老街调查
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "老街",
    "intent": "调查",
    "topic": "",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 老街
            intent: 调查
            topic: 
            risk: medium
            完整解析：{"action_type": "exploration", "target": "老街", "intent": "调查", "topic": "", "risk": "medium"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 45, "magic_density": 2, "corruption": 19, "radiation": 1}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "前往老街调查"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：medium

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：1 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你走进老街，发现这里的气氛异常紧张。街道上有些破烂的招牌和隐约的耳语，似乎隐藏着许多秘密。你注意到墙壁上有几处可疑的痕迹，可能是线索的开端。",
    "options": ["仔细观察墙壁痕迹", "询问路过的居民", "继续探索其他地方"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：仔细观察墙壁痕迹
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "墙壁",
    "intent": "调查",
    "topic": "痕迹",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 墙壁
            intent: 调查
            topic: 痕迹
            risk: low
            完整解析：{"action_type": "exploration", "target": "墙壁", "intent": "调查", "topic": "痕迹", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 44, "magic_density": 4, "corruption": 17, "radiation": 1}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "仔细观察墙壁痕迹"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：medium

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：1 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "在墙壁上，你观察到一些模糊的痕迹，似乎是某种工具留下的。仔细调查后，你发现这些痕迹沿着墙面延伸，可能通往一个隐藏的通道。周围的气氛让你感到紧张，似乎有什么东西躲在暗处。你决定继续寻找线索。",
    "options": ["继续调查墙壁痕迹", "寻找其他线索", "回到原来的地方"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续调查墙壁痕迹
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "墙壁",
    "intent": "调查",
    "topic": "痕迹",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 墙壁
            intent: 调查
            topic: 痕迹
            risk: low
            完整解析：{"action_type": "exploration", "target": "墙壁", "intent": "调查", "topic": "痕迹", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 43, "magic_density": 7, "corruption": 19, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续调查墙壁痕迹"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：medium

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：1 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你仔细调查了墙壁上的痕迹，发现了一些模糊的印记，似乎是某种动物留下的。墙壁的表面异常湿润，可能暗示着最近有动静。你在这些痕迹附近发现了些微的黑色毛发，似乎属于某种猫科动物，这引起了你的注意。",
    "options": ["进一步分析痕迹", "寻找其他线索", "询问附近的 NPC"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：寻找其他线索
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": null,
    "intent": "调查",
    "topic": "线索",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: None
            intent: 调查
            topic: 线索
            risk: medium
            完整解析：{"action_type": "exploration", "target": null, "intent": "调查", "topic": "线索", "risk": "medium"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 45, "magic_density": 7, "corruption": 17, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "寻找其他线索"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：medium

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：1 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你在废弃的仓库内仔细调查，注意到墙角有一些新鲜的刮痕，似乎是某种重物拖动留下的痕迹。同时，你发现地面上有几片未干的泥土，带着草香，表明最近有人经过。线索的复杂程度在加深，你感到事情并没有那么简单。",
    "options": ["进一步调查刮痕", "检查泥土和草香", "寻找其他地方的线索"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：检查泥土和草香
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "泥土和草",
    "intent": "调查",
    "topic": "泥土和草香",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 泥土和草
            intent: 调查
            topic: 泥土和草香
            risk: low
            完整解析：{"action_type": "exploration", "target": "泥土和草", "intent": "调查", "topic": "泥土和草香", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 47, "magic_density": 5, "corruption": 19, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "检查泥土和草香"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你仔细调查泥土和草的香气，发现其中混杂着一种奇异的甜味，似乎与附近某种植物有关。随着调查的深入，你注意到泥土里埋藏着一些小小的痕迹，像是动物的足迹，指向了更深的灌木丛。这样的发现引起了你的兴趣，也让你感到一丝紧张。",
    "options": ["继续调查足迹", "返回询问 NPC", "收集样本进行分析"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：收集样本进行分析
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "样本",
    "intent": "收集",
    "topic": "样本分析",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 样本
            intent: 收集
            topic: 样本分析
            risk: medium
            完整解析：{"action_type": "exploration", "target": "样本", "intent": "收集", "topic": "样本分析", "risk": "medium"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 47, "magic_density": 7, "corruption": 17, "radiation": 2}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "收集样本进行分析"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你在一个阴暗的实验室中仔细观察样本，发现了一个隐藏的通道，通道内散发着微弱的蓝光。你收集到的样本中夹杂着未知物质，似乎与最近的失踪事件有关。这可能是个关键线索，但也让你感到一丝不安。",
    "options": ["进一步调查通道", "返回并分析样本", "寻找其他线索"],
    "health_change": 0,
    "world_state_change": {"tension": 50},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：进一步调查通道
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "通道",
    "intent": "调查",
    "topic": "通道",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 通道
            intent: 调查
            topic: 通道
            risk: medium
            完整解析：{"action_type": "exploration", "target": "通道", "intent": "调查", "topic": "通道", "risk": "medium"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 49, "magic_density": 5, "corruption": 18, "radiation": 3}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "进一步调查通道"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你进入通道，四周的墙壁上布满了神秘的符号，似乎在讲述着某个古老的故事。你仔细调查，发现地面上有几块磨损的痕迹，可能是某个物体被拖过的迹象。通道的尽头传来微弱的低语声，令人感到不安。",
  "options": ["继续调查符号", "跟随低语声", "返回"],
  "health_change": 0,
  "world_state_change": {
    "tension": 52,
    "magic_density": 5,
    "corruption": 18,
    "radiation": 3
  },
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：跟随低语声
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": null,
    "intent": "调查",
    "topic": "低语声",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: None
            intent: 调查
            topic: 低语声
            risk: medium
            完整解析：{"action_type": "exploration", "target": null, "intent": "调查", "topic": "低语声", "risk": "medium"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 50, "magic_density": 5, "corruption": 17, "radiation": 1}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "跟随低语声"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你跟随低语声深入一条狭窄的巷道，墙壁上布满了模糊的痕迹，似乎有人曾在此留下过急促的足迹。低语声逐渐清晰，透露出一些关于失踪者的模糊信息，却又让你感到一阵不安。你貌似接近了某个隐藏的秘密，但周围的气氛变得紧张。",
    "options": ["继续调查低语声", "返回寻找其他线索"],
    "health_change": 0,
    "world_state_change": {"tension": 55},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续调查低语声
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": null,
    "intent": "调查",
    "topic": "低语声",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: None
            intent: 调查
            topic: 低语声
            risk: medium
            完整解析：{"action_type": "exploration", "target": null, "intent": "调查", "topic": "低语声", "risk": "medium"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 51, "magic_density": 5, "corruption": 16, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续调查低语声"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：3 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你深入调查低语声的来源，发现这声音似乎来自一个隐藏的地下室，低沉而模糊。随着你靠近，周围的空气变得更加紧张，似乎隐藏着某种秘密。你注意到墙壁上的一些奇怪的符号，似乎与失踪事件有关。",
  "options": [
    "进一步调查地下室",
    "尝试解读墙壁上的符号",
    "回去找小白讨论"
  ],
  "health_change": 0,
  "world_state_change": {
    "tension": 55
  },
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：尝试解读墙壁上的符号
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "墙壁上的符号",
    "intent": "调查",
    "topic": "符号",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 墙壁上的符号
            intent: 调查
            topic: 符号
            risk: low
            完整解析：{"action_type": "exploration", "target": "墙壁上的符号", "intent": "调查", "topic": "符号", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 52, "magic_density": 3, "corruption": 16, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "尝试解读墙壁上的符号"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：3 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你靠近墙壁，仔细观察那些神秘的符号。随着调查的深入，你发现这些符号似乎与失踪事件有某种联系，可能暗示隐藏的秘密。墙壁上有一处特别的标记，光线在此处微微闪烁，似乎在引导你进一步探索。",
    "options": ["仔细解读符号", "寻找其他线索", "询问小白关于这些符号的看法"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：询问小白关于这些符号的看法
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "小白",
    "intent": "询问",
    "topic": "符号",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 小白
            intent: 询问
            topic: 符号
            risk: low
            完整解析：{"action_type": "social", "target": "小白", "intent": "询问", "topic": "符号", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 53, "magic_density": 4, "corruption": 18, "radiation": 1}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 70, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "询问小白关于这些符号的看法"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：3 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（social）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你询问小白关于这些符号的看法，小白眼中闪过一丝思索的光芒，似乎在回忆某个重要的线索。她的声音在空气中逐渐加重，透露出一丝紧张，似乎这些符号与她所追寻的真相息息相关。",
    "options": ["进一步询问小白", "观察周围寻找其他线索", "暂时离开这个话题"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": [{"name": "小白", "trust": 65}]
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：观察周围寻找其他线索
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": null,
    "intent": "调查",
    "topic": "线索",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: None
            intent: 调查
            topic: 线索
            risk: low
            完整解析：{"action_type": "exploration", "target": null, "intent": "调查", "topic": "线索", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 55, "magic_density": 5, "corruption": 21, "radiation": 1}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 71, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "观察周围寻找其他线索"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：3 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你仔细观察周围，发现墙上有一些奇怪的划痕，似乎是有人在这里留下的痕迹。地面上散落着几片纸屑，上面模糊的字迹可能是某个重要线索。空气中弥漫着一股紧张的气氛，让你不禁加快了调查的速度。",
    "options": ["继续调查纸屑", "检查墙上的划痕", "寻找其他可能的线索"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续调查纸屑
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "纸屑",
    "intent": "调查",
    "topic": "纸屑",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 纸屑
            intent: 调查
            topic: 纸屑
            risk: low
            完整解析：{"action_type": "exploration", "target": "纸屑", "intent": "调查", "topic": "纸屑", "risk": "low"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 56, "magic_density": 3, "corruption": 23, "radiation": 4}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 71, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续调查纸屑"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：4 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你仔细调查了纸屑，发现上面有一串模糊的文字，似乎是某种密码或线索。周围的空气中弥漫着紧张的气氛，仿佛隐藏着更多秘密。在纸屑的附近，你注意到地面上有几道细微的划痕，可能是某个物体被拖曳过的痕迹。",
    "options": ["继续调查纸屑", "跟随划痕", "寻找其他线索"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：跟随划痕
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "划痕",
    "intent": "调查",
    "topic": "划痕",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 划痕
            intent: 调查
            topic: 划痕
            risk: medium
            完整解析：{"action_type": "exploration", "target": "划痕", "intent": "调查", "topic": "划痕", "risk": "medium"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 57, "magic_density": 2, "corruption": 21, "radiation": 5}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 71, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "跟随划痕"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：4 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你在划痕附近仔细调查，发现它们通往一处被遗弃的废弃建筑，周围充满了微弱的低语声与紧张气氛。你注意到划痕似乎有规律地排列，像是在指引你朝某个方向走去。",
    "options": ["继续跟随划痕", "回去探索其他地方", "尝试找寻声音的来源"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续跟随划痕
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "划痕",
    "intent": "调查",
    "topic": "划痕",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 划痕
            intent: 调查
            topic: 划痕
            risk: medium
            完整解析：{"action_type": "exploration", "target": "划痕", "intent": "调查", "topic": "划痕", "risk": "medium"}

            ==================== 事件类型模板（必须遵守） ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 60, "magic_density": 0, "corruption": 23, "radiation": 6}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 6, "敏捷": 8, "智力": 9}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "侦探", "short_desc": "一只聪明机智的白猫，善于推理与观察，渴望解开失踪之谜。", "stats": {"trust": 71, "fear": 20, "health": 90, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "神秘商人", "short_desc": "一只神秘的黑猫，掌握着城市的秘密与古老的传说，交易中充满陷阱。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["圆滑", "机敏"], "speech_style": "客套、谨慎、观察对方反应"}}, {"name": "喵星人", "role": "科学家", "short_desc": "一只充满好奇心的橘猫，研究猫咪科技，试图解决城市面临的问题。", "stats": {"trust": 90, "fear": 10, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续跟随划痕"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            ['失踪']

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：4 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你仔细调查划痕，发现它们通往一个被遗弃的角落，那里散落着几片神秘的纸张。纸张上似乎有一些模糊的符号，散发着微弱的光芒。这可能是一个未解之谜的关键线索。",
  "options": ["检查纸张上的符号", "继续跟随划痕", "寻找其他线索"],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    

=== USER PROMPT ===

                你是这个世界的 DM。主线任务已经达成，请生成【终章事件】。

                要求：
                - 叙事 4~6 句
                - 汇总此前所有重要线索（NPC、黑暗力量、水晶、魔法阵）
                - 给出世界最终结局（胜利 / 失败 / 牺牲 / 未知）
                - 氛围必须符合当前 world_state
                - 不要再提供 options（冒险结束）
                - 输出严格 JSON：

                {
                "dm_text": "最终剧情",
                "options": [],
                "health_change": 0,
                "world_state_change": {},
                "player_change": {},
                "npc_change": []
                }
                

=== GPT RAW OUTPUT ===
{
    "dm_text": "在黑暗力量的侵袭下，主角与队友们终于找到了关键的水晶，并成功激活了魔法阵。经过激烈的战斗，他们击败了主要的敌对NPC，然而代价惨重。虽然黑暗势力被封印，世界暂时恢复了平静，但队伍中的一名成员为了保护同伴而牺牲。最终，虽迎来了短暂的胜利，却也留下了无尽的哀痛与思考，世界的未来依旧充满未知。",
    "options": [],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===
You are an expert RPG chronicler who writes evocative summaries.

=== USER PROMPT ===
请总结以下冒险为一段叙述风格的冒险回顾，突出情节要点和关键角色：

Player: (start)
DM: 在猫咪主宰的城市中心，一个阳光明媚的下午，街道上飘荡着鱼香和草的气息，市民们悠闲地享受着生活。你走过一座华丽的猫咪雕像，耳边听到一只老猫正在低声讲述古老的传说，吸引了一群好奇的年轻猫咪围坐在旁。就在这时，传来一声急促的喵叫，打断了宁静，似乎是来自不远处的市集。 

1. 前往市集查看发生了什么事。  
2. 静静地观察老猫，倾听更多的故事。  
3. 找个地方休息，享受这宁静的下午。
Player: 前往市集查看发生了什么事。  
DM: 你在市集上观察到一些异常的活动，周围的商贩们似乎互相低声交谈，神情紧张。你发现地面上有几处被踩踏过的痕迹，似乎刚刚发生过什么事情。听到一位商贩提到最近失踪的猫咪，你感到事情并不简单。
Player: 询问商贩关于失踪猫咪的更多信息
DM: 你走到黑夜身边，询问他关于失踪猫咪的事情。他微微皱眉，似乎在考虑如何回答。"我听说，有人最后看到它在老街附近徘徊，但具体的情况我就不太清楚了，你最好小心些，那地方最近有些不太对劲。"
Player: 前往老街调查
DM: 你走进老街，发现这里的气氛异常紧张。街道上有些破烂的招牌和隐约的耳语，似乎隐藏着许多秘密。你注意到墙壁上有几处可疑的痕迹，可能是线索的开端。
Player: 仔细观察墙壁痕迹
DM: 在墙壁上，你观察到一些模糊的痕迹，似乎是某种工具留下的。仔细调查后，你发现这些痕迹沿着墙面延伸，可能通往一个隐藏的通道。周围的气氛让你感到紧张，似乎有什么东西躲在暗处。你决定继续寻找线索。
Player: 继续调查墙壁痕迹
DM: 你仔细调查了墙壁上的痕迹，发现了一些模糊的印记，似乎是某种动物留下的。墙壁的表面异常湿润，可能暗示着最近有动静。你在这些痕迹附近发现了些微的黑色毛发，似乎属于某种猫科动物，这引起了你的注意。
Player: 寻找其他线索
DM: 你在废弃的仓库内仔细调查，注意到墙角有一些新鲜的刮痕，似乎是某种重物拖动留下的痕迹。同时，你发现地面上有几片未干的泥土，带着草香，表明最近有人经过。线索的复杂程度在加深，你感到事情并没有那么简单。
Player: 检查泥土和草香
DM: 你仔细调查泥土和草的香气，发现其中混杂着一种奇异的甜味，似乎与附近某种植物有关。随着调查的深入，你注意到泥土里埋藏着一些小小的痕迹，像是动物的足迹，指向了更深的灌木丛。这样的发现引起了你的兴趣，也让你感到一丝紧张。
Player: 收集样本进行分析
DM: 你在一个阴暗的实验室中仔细观察样本，发现了一个隐藏的通道，通道内散发着微弱的蓝光。你收集到的样本中夹杂着未知物质，似乎与最近的失踪事件有关。这可能是个关键线索，但也让你感到一丝不安。
Player: 进一步调查通道
DM: 你进入通道，四周的墙壁上布满了神秘的符号，似乎在讲述着某个古老的故事。你仔细调查，发现地面上有几块磨损的痕迹，可能是某个物体被拖过的迹象。通道的尽头传来微弱的低语声，令人感到不安。
Player: 跟随低语声
DM: 你跟随低语声深入一条狭窄的巷道，墙壁上布满了模糊的痕迹，似乎有人曾在此留下过急促的足迹。低语声逐渐清晰，透露出一些关于失踪者的模糊信息，却又让你感到一阵不安。你貌似接近了某个隐藏的秘密，但周围的气氛变得紧张。
Player: 继续调查低语声
DM: 你深入调查低语声的来源，发现这声音似乎来自一个隐藏的地下室，低沉而模糊。随着你靠近，周围的空气变得更加紧张，似乎隐藏着某种秘密。你注意到墙壁上的一些奇怪的符号，似乎与失踪事件有关。
Player: 尝试解读墙壁上的符号
DM: 你靠近墙壁，仔细观察那些神秘的符号。随着调查的深入，你发现这些符号似乎与失踪事件有某种联系，可能暗示隐藏的秘密。墙壁上有一处特别的标记，光线在此处微微闪烁，似乎在引导你进一步探索。
Player: 询问小白关于这些符号的看法
DM: 你询问小白关于这些符号的看法，小白眼中闪过一丝思索的光芒，似乎在回忆某个重要的线索。她的声音在空气中逐渐加重，透露出一丝紧张，似乎这些符号与她所追寻的真相息息相关。
Player: 观察周围寻找其他线索
DM: 你仔细观察周围，发现墙上有一些奇怪的划痕，似乎是有人在这里留下的痕迹。地面上散落着几片纸屑，上面模糊的字迹可能是某个重要线索。空气中弥漫着一股紧张的气氛，让你不禁加快了调查的速度。
Player: 继续调查纸屑
DM: 你仔细调查了纸屑，发现上面有一串模糊的文字，似乎是某种密码或线索。周围的空气中弥漫着紧张的气氛，仿佛隐藏着更多秘密。在纸屑的附近，你注意到地面上有几道细微的划痕，可能是某个物体被拖曳过的痕迹。
Player: 跟随划痕
DM: 你在划痕附近仔细调查，发现它们通往一处被遗弃的废弃建筑，周围充满了微弱的低语声与紧张气氛。你注意到划痕似乎有规律地排列，像是在指引你朝某个方向走去。
Player: 继续跟随划痕
DM: 你仔细调查划痕，发现它们通往一个被遗弃的角落，那里散落着几片神秘的纸张。纸张上似乎有一些模糊的符号，散发着微弱的光芒。这可能是一个未解之谜的关键线索。
Player: (final)
DM: 在黑暗力量的侵袭下，主角与队友们终于找到了关键的水晶，并成功激活了魔法阵。经过激烈的战斗，他们击败了主要的敌对NPC，然而代价惨重。虽然黑暗势力被封印，世界暂时恢复了平静，但队伍中的一名成员为了保护同伴而牺牲。最终，虽迎来了短暂的胜利，却也留下了无尽的哀痛与思考，世界的未来依旧充满未知。

=== GPT RAW OUTPUT ===
在一个阳光明媚的下午，猫咪主宰的城市散发着鱼香和草香的气息，然而这份宁静在市集的急促喵叫声中被打破。主角决心深入调查，发现市集中的商贩们神情紧张，谈论着最近失踪的猫咪。通过询问商贩，主角得知失踪的猫咪最后出现在老街附近。

走进老街，主角感受到一种隐秘的紧张气氛，墙壁上的模糊痕迹引起了他的注意。仔细观察后，发现这些痕迹通向一个隐藏的通道，周围隐隐传来低语声。随着深入调查，主角发现通道的墙壁上布满神秘符号，似乎与失踪事件息息相关。

在一个阴暗的实验室里，主角对收集到的样本进行分析，发现其中夹杂着未知物质，与失踪事件密切相关。跟随低语声，主角最终接近一个隐藏的地下室，墙壁上的符号和纸屑揭示着更深层的秘密。小白的出现引导着主角探寻这些符号的真相。

随着调查的逐步深入，主角和队友们终于在黑暗力量的侵袭下找到了一颗关键的水晶。他们成功激活了魔法阵，击败了主要的敌对NPC。然而，胜利的代价是队伍中一名成员的牺牲，这一刻虽然封印了黑暗势力，使世界暂时恢复了平静，却也在每个幸存者心中留下了深深的哀痛与思考。未来依旧充满未知，新的冒险正在悄然酝酿。
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据玩家的创意构建一个完整的 RPG 世界。

        玩家创意：
        猫猫世界

        当前 UI 语言：中文

        语言要求（非常重要）：
        - 如果 UI 语言是 "中文"，则除了 JSON 的 key（如 "title"）必须保持英文外，
        所有 value（标题、简介、地点名称与描述、角色名称与描述、initial_hook、
        world_logic 里的 culture 等等）都必须使用自然流畅的中文。
        - 如果 UI 语言是 "English"，则所有 value 都必须使用自然流畅的英文。

        请输出 JSON，字段如下：
        

        {
        "title": "...",
        "summary": "...",
        "initial_hook": "...",
        "locations": [
            {"name": "...", "description": "...", "tags": ["city","ruin"], "danger": 0-100}
        ],
        "characters": [
            {
                "name": "...",
                "role": "...",
                "short_desc": "...",
                "stats": {
                    "trust": 0-100,
                    "fear": 0-100,
                    "health": 50-120,
                    "custom": {}
                }
            }
        ],

        "world_logic": {
            "allow_magic": true/false,
            "tech_level": "stone_age | medieval | industrial | modern | sci_fi",
            "energy_system": "...",
            "physics_rules": "...",
            "culture": "...",
            "world_type": "desert | frost | volcanic | apocalypse | forest | ocean"
        },

        "initial_state": {
            "tension": 0-100,
            "magic_density": 0-100,
            "corruption": 0-100,
            "radiation": 0-100
        }
        }

        要求：
        - 输出严格 JSON
        - 不要解释
        - 内容必须与玩家的创意一致
        - initial_state 的数值必须由世界逻辑推导
        

=== GPT RAW OUTPUT ===
{
    "title": "猫猫世界",
    "summary": "一个充满喵星人和奇幻冒险的世界，猫咪们在这片土地上探索、战斗和建立自己的王国。",
    "initial_hook": "在猫猫世界的边境，神秘的黑暗力量正在逐渐侵蚀土地，猫咪们聚集起来准备抵抗这场灾难。",
    "locations": [
        {
            "name": "喵星城",
            "description": "一个繁华的城市，街道上充满了猫咪们的欢声笑语，市场上交易着各种美味的鱼干与玩具。",
            "tags": ["city"],
            "danger": 10
        },
        {
            "name": "猫咪森林",
            "description": "一片神秘的森林，树木高大繁茂，隐藏着古老的秘密和许多未知的危险。",
            "tags": ["forest"],
            "danger": 40
        },
        {
            "name": "喵喵庙",
            "description": "一座古老的寺庙，供奉着猫咪的守护神，传说中这里藏有强大的魔法遗物。",
            "tags": ["ruin"],
            "danger": 70
        }
    ],
    "characters": [
        {
            "name": "小白",
            "role": "探险者",
            "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。",
            "stats": {
                "trust": 75,
                "fear": 20,
                "health": 100,
                "custom": {}
            }
        },
        {
            "name": "黑夜",
            "role": "巫师",
            "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。",
            "stats": {
                "trust": 30,
                "fear": 60,
                "health": 80,
                "custom": {}
            }
        }
    ],
    "world_logic": {
        "allow_magic": true,
        "tech_level": "medieval",
        "energy_system": "自然能量",
        "physics_rules": "遵循常规物理法则，但魔法可以改变现实。",
        "culture": "猫咪们崇尚自由与冒险，拥有丰富的传说与传统。",
        "world_type": "forest"
    },
    "initial_state": {
        "tension": 60,
        "magic_density": 80,
        "corruption": 20,
        "radiation": 0
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        为这个世界写一句话主线任务（目标句子，不要剧情）。
        世界信息：
        {"title": "猫猫世界", "summary": "一个充满喵星人和奇幻冒险的世界，猫咪们在这片土地上探索、战斗和建立自己的王国。", "initial_hook": "在猫猫世界的边境，神秘的黑暗力量正在逐渐侵蚀土地，猫咪们聚集起来准备抵抗这场灾难。", "locations": [{"name": "喵星城", "description": "一个繁华的城市，街道上充满了猫咪们的欢声笑语，市场上交易着各种美味的鱼干与玩具。", "tags": ["city"], "danger": 10}, {"name": "猫咪森林", "description": "一片神秘的森林，树木高大繁茂，隐藏着古老的秘密和许多未知的危险。", "tags": ["forest"], "danger": 40}, {"name": "喵喵庙", "description": "一座古老的寺庙，供奉着猫咪的守护神，传说中这里藏有强大的魔法遗物。", "tags": ["ruin"], "danger": 70}], "characters": [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}}], "world_logic": {"allow_magic": true, "tech_level": "medieval", "energy_system": "自然能量", "physics_rules": "遵循常规物理法则，但魔法可以改变现实。", "culture": "猫咪们崇尚自由与冒险，拥有丰富的传说与传统。", "world_type": "forest"}, "initial_state": {"tension": 60, "magic_density": 80, "corruption": 20, "radiation": 0}}
        只输出一句话。

=== GPT RAW OUTPUT ===
{"main_quest":"联合各地猫咪的力量，阻止黑暗力量侵蚀猫猫世界，拯救家园。"}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG world designer.
    Your job is to produce compact, clean, structured JSON describing a fictional world.

    Rules:
    - Never include explanations outside the JSON (except brief notes after).
    - Keep all text concise, vivid, and easy to play in an adventure.
    - Keep descriptions no longer than 2–3 sentences each.
    - Do not invent new sections not requested.
    - Do not add comments, disclaimers, or markdown.
    

=== USER PROMPT ===

        根据以下世界内容，为这个世界生成一个“玩家角色”（主角）。

        世界信息：
        {"title": "猫猫世界", "summary": "一个充满喵星人和奇幻冒险的世界，猫咪们在这片土地上探索、战斗和建立自己的王国。", "initial_hook": "在猫猫世界的边境，神秘的黑暗力量正在逐渐侵蚀土地，猫咪们聚集起来准备抵抗这场灾难。", "locations": [{"name": "喵星城", "description": "一个繁华的城市，街道上充满了猫咪们的欢声笑语，市场上交易着各种美味的鱼干与玩具。", "tags": ["city"], "danger": 10}, {"name": "猫咪森林", "description": "一片神秘的森林，树木高大繁茂，隐藏着古老的秘密和许多未知的危险。", "tags": ["forest"], "danger": 40}, {"name": "喵喵庙", "description": "一座古老的寺庙，供奉着猫咪的守护神，传说中这里藏有强大的魔法遗物。", "tags": ["ruin"], "danger": 70}], "characters": [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}}], "world_logic": {"allow_magic": true, "tech_level": "medieval", "energy_system": "自然能量", "physics_rules": "遵循常规物理法则，但魔法可以改变现实。", "culture": "猫咪们崇尚自由与冒险，拥有丰富的传说与传统。", "world_type": "forest"}, "initial_state": {"tension": 60, "magic_density": 80, "corruption": 20, "radiation": 0}, "main_quest": "{\"main_quest\":\"联合各地猫咪的力量，阻止黑暗力量侵蚀猫猫世界，拯救家园。\"}"}

        输出 JSON，字段如下：

        {
        "player_profile": {
            "name": "玩家名字（符合世界语言风格，用 中文）",
            "background": "玩家的身世背景（2-3句话）",
            "profession": "职业 / 角色类别",
            "role_in_world": "外来者 | 被选中者 | 探险家 | 流民 | 学者 等",
            "traits": ["2~4 个个性特质"],
            "weakness": ["1~2 个弱点"]
        },
        "player_stats": {
            "health": 100,
            "sanity": 60~120,
            "mana": 0~100,           // 如果世界逻辑 allow_magic = false 则 mana = 0
            "custom": {
                "力量": 1~10,
                "敏捷": 1~10,
                "智力": 1~10
            }
        }
        }

        要求：
        - 所有字段必须符合世界逻辑 world_logic 中的 tech_level / allow_magic / energy_system
        - 名字、描述都必须使用语言：中文
        - 只输出 JSON，不要解释
        

=== GPT RAW OUTPUT ===
{
    "player_profile": {
        "name": "星辰",
        "background": "一只来自喵星城的小猫，因好奇心驱使而走出家门，踏上了冒险之旅。她在旅途中结识了许多朋友，并决心保护猫猫世界免受黑暗力量的侵袭。",
        "profession": "游侠",
        "role_in_world": "探险家",
        "traits": ["勇敢", "机智", "好奇"],
        "weakness": ["缺乏经验", "容易信任他人"]
    },
    "player_stats": {
        "health": 100,
        "sanity": 90,
        "mana": 0,
        "custom": {
            "力量": 7,
            "敏捷": 9,
            "智力": 5
        }
    }
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a professional TTRPG Dungeon Master.
    Your task is to narrate scenes and present clear, meaningful choices.

    General Rules:
    - Do NOT use speaker labels ("DM:" "Player:" etc.).
    - Write short, tight narrative paragraphs (2–4 sentences).
    - Always maintain consistency with world facts and main quest.
    - Keep pacing dynamic: each round must progress the story.
    - Avoid lists except for final 3 numbered action options.
    - Never explain rules or meta-thought.
    

=== USER PROMPT ===

        使用 中文。

        你必须根据这个世界的内容生成一个结构化的开场事件：
        世界总结：
        "一个充满喵星人和奇幻冒险的世界，猫咪们在这片土地上探索、战斗和建立自己的王国。"

        地点列表：
        [{"name": "喵星城", "description": "一个繁华的城市，街道上充满了猫咪们的欢声笑语，市场上交易着各种美味的鱼干与玩具。", "tags": ["city"], "danger": 10}, {"name": "猫咪森林", "description": "一片神秘的森林，树木高大繁茂，隐藏着古老的秘密和许多未知的危险。", "tags": ["forest"], "danger": 40}, {"name": "喵喵庙", "description": "一座古老的寺庙，供奉着猫咪的守护神，传说中这里藏有强大的魔法遗物。", "tags": ["ruin"], "danger": 70}]

        主要角色：
        [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

        开场事件规则（务必严格遵守）：
        - 氛围：2~4 句
        - 内容必须发生在某个具体地点（地点名需点名）
        - 至少出现 1 个世界中的角色（体现性格 traits 与 speech_style）
        - 必须引出一个“开端冲突”（例如：异动、骚乱、失踪、可疑人物）
        - 不得给任何深层秘密（序章只能浅提示）

        行动选项必须 EXACTLY 3 个，分别对应：
        1. exploration（调查/观察）
        2. social（与某个角色交谈）
        3. move（前往一个新地点）

        选项格式（严格）：
        1. 文本
        2. 文本
        3. 文本
    

=== GPT RAW OUTPUT ===
在繁华的喵星城，阳光透过街道上的彩旗洒落，猫咪们在市场上欢快地嬉闹。突然，一阵低沉的猫叫声打破了欢乐的氛围，街道的一角聚集了一群神情紧张的猫咪，似乎发生了什么不寻常的事情。小白，勇敢的探险者，眼中闪烁着好奇和警惕，决定要揭开这个神秘事件的真相。

“听说，有几只猫咪在猫咪森林中失踪了，”小白对周围的猫咪说道，语气中透着急切，“我们不能坐视不管。”然而，不远处，黑夜，那个神秘的巫师，似乎在阴影中静静观察这一切，眼中掠过一丝复杂的情绪。

现在，选择你们的行动吧：

1. 调查失踪猫咪的消息，寻找更多线索。
2. 与小白或黑夜交谈，了解更多情况。
3. 直接前往猫咪森林，寻找失踪的猫咪。
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：与小白或黑夜交谈，了解更多情况。
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "小白或黑夜",
    "intent": "询问",
    "topic": "情况",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 小白或黑夜
            intent: 询问
            topic: 情况
            risk: low
            完整解析：{"action_type": "social", "target": "小白或黑夜", "intent": "询问", "topic": "情况", "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：social
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：0

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 61, "magic_density": 80, "corruption": 19, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "与小白或黑夜交谈，了解更多情况。"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：shallow

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：0 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（social）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你走向小白，询问她目前的情况。小白看起来有些兴奋，眼中闪烁着冒险的光芒，她说：\"我们正准备探索一个新的地方，听说那里藏着神秘的宝藏！不过我有点担心，我们需要小心。\"",
  "options": ["继续询问小白的计划", "与黑夜交谈了解更多情况"],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：与黑夜交谈了解更多情况
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "social",
    "target": "黑夜",
    "intent": "询问",
    "topic": "情况",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: social
            target: 黑夜
            intent: 询问
            topic: 情况
            risk: low
            完整解析：{"action_type": "social", "target": "黑夜", "intent": "询问", "topic": "情况", "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：social
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：0

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 64, "magic_density": 80, "corruption": 21, "radiation": 0}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 30, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "与黑夜交谈了解更多情况"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：shallow

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：0 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（social）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你向黑夜询问当前的情况。他微微皱眉，语气平淡地说：“这个世界依然笼罩在未知之中，很多事情都不如表面那般简单。”他的神秘气息让你感到一丝不安。",
  "options": ["继续询问黑夜", "改变话题", "离开黑夜"],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：离开黑夜
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "move",
    "target": null,
    "intent": "离开",
    "topic": "黑夜",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: move
            target: None
            intent: 离开
            topic: 黑夜
            risk: low
            完整解析：{"action_type": "move", "target": null, "intent": "离开", "topic": "黑夜", "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：move
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：1

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 64, "magic_density": 81, "corruption": 21, "radiation": 2}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "离开黑夜"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：no_information

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：1 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（move）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你离开了黑夜的阴影，走入一片月光洒落的空地。周围是寂静的夜晚，只有微风轻轻拂过树叶，似乎隐藏着什么秘密。前方有一条小路，通向未知的地方。",
  "options": ["继续前行", "返回黑夜", "观察周围环境"],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续前行
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "move",
    "target": null,
    "intent": "移动",
    "topic": null,
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: move
            target: None
            intent: 移动
            topic: None
            risk: low
            完整解析：{"action_type": "move", "target": null, "intent": "移动", "topic": null, "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：move
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：1

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 62, "magic_density": 82, "corruption": 20, "radiation": 5}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续前行"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：no_information

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：1 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（move）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你继续前行，来到了一个开阔的草地，四周是高耸的树木，阳光透过树叶洒下斑驳的光影。在草地的中央，你发现了一个指向不同方向的古老石碑，上面刻有模糊的符号和文字，似乎指引着冒险者。你可以选择调查石碑，或继续往草地另一边的森林深处移动。",
    "options": ["调查石碑", "继续往森林深处移动"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续往森林深处移动
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "move",
    "target": null,
    "intent": "移动",
    "topic": "森林",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: move
            target: None
            intent: 移动
            topic: 森林
            risk: medium
            完整解析：{"action_type": "move", "target": null, "intent": "移动", "topic": "森林", "risk": "medium"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：move
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：1

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 61, "magic_density": 81, "corruption": 20, "radiation": 7}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续往森林深处移动"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：no_information

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：1 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（move）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你沿着森林小径继续深入，四周的树木变得更加茂密，阳光透过树叶洒下斑驳的光影。你听见远处传来轻微的动物叫声，似乎有些东西在窥视你。前方的道路出现了两个方向，一个是向左通向一片开阔地，另一个则更深处的树林，看起来更阴暗。",
    "options": ["向左走去开阔地", "继续深入阴暗的树林"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续往森林深处移动
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "move",
    "target": null,
    "intent": "移动",
    "topic": "森林",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: move
            target: None
            intent: 移动
            topic: 森林
            risk: medium
            完整解析：{"action_type": "move", "target": null, "intent": "移动", "topic": "森林", "risk": "medium"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：move
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：1

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 60, "magic_density": 80, "corruption": 21, "radiation": 6}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续往森林深处移动"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：no_information

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：1 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（move）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你继续往森林深处移动，环境逐渐变得更加阴暗，树木高耸，遮挡了大部分光线。你听到周围传来轻微的沙沙声，似乎有什么东西在观察你。前方出现了一条岔路，左侧通往一个小溪边，而右侧则延伸向更密集的树林。",
  "options": ["向左走，前往小溪", "向右走，深入密林"],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：向左走，前往小溪
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "move",
    "target": "小溪",
    "intent": "移动",
    "topic": "小溪",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: move
            target: 小溪
            intent: 移动
            topic: 小溪
            risk: low
            完整解析：{"action_type": "move", "target": "小溪", "intent": "移动", "topic": "小溪", "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：move
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：2

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 62, "magic_density": 83, "corruption": 21, "radiation": 6}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "向左走，前往小溪"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：no_information

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（move）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你向左走，抵达了小溪边。溪水潺潺流动，四周环境幽静，树木环绕。你发现溪水旁的石头上有一些奇怪的符号，这可能是探索的线索。",
  "options": ["观察符号", "继续沿小溪移动", "返回上一个地点"],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：观察符号
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "符号",
    "intent": "调查",
    "topic": "符号",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 符号
            intent: 调查
            topic: 符号
            risk: low
            完整解析：{"action_type": "exploration", "target": "符号", "intent": "调查", "topic": "符号", "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：exploration
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：2

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 60, "magic_density": 83, "corruption": 24, "radiation": 9}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "观察符号"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你观察到符号表面有细微的光泽，似乎是用某种魔法材料绘制而成。它们在昏暗的光线下闪烁，发出微弱的低语声，这些声音在空间中回荡，仿佛在传递着古老的秘密。你仔细审视，发现这些符号排列成特定的图案，可能指引着某个方向。",
    "options": ["深入记录符号的细节", "尝试触碰符号", "寻找周围是否有其他线索"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：尝试触碰符号
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "符号",
    "intent": "调查",
    "topic": "符号",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 符号
            intent: 调查
            topic: 符号
            risk: medium
            完整解析：{"action_type": "exploration", "target": "符号", "intent": "调查", "topic": "符号", "risk": "medium"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：exploration
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：2

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 61, "magic_density": 82, "corruption": 24, "radiation": 8}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "尝试触碰符号"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你仔细观察这个符号，发现它的表面凹凸不平，闪烁着微弱的光芒，似乎隐藏着某种能量。随着你的触碰，周围的空气开始悸动，隐约听到耳边传来低语声，仿佛在警告你不要靠近。",
  "options": [
    "继续调查符号",
    "离开符号"
  ],
  "health_change": 0,
  "world_state_change": {
    "tension": 65
  },
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续调查符号
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "符号",
    "intent": "调查",
    "topic": "符号",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 符号
            intent: 调查
            topic: 符号
            risk: medium
            完整解析：{"action_type": "exploration", "target": "符号", "intent": "调查", "topic": "符号", "risk": "medium"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：exploration
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：2

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 59, "magic_density": 83, "corruption": 22, "radiation": 7}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续调查符号"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你仔细观察这组符号，发现它们在墙壁上有微微发光的痕迹，似乎暗藏着某种力量。随着你的调查，周围的空气开始变得紧张，似乎有什么东西正在靠近。你感觉到一种未知的威胁，令你心中不安。",
  "options": [
    "继续深入调查符号",
    "寻找附近的隐蔽处",
    "准备好应对潜在威胁"
  ],
  "health_change": 0,
  "world_state_change": {
    "tension": 65
  },
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：准备好应对潜在威胁
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "stealth",
    "target": "潜在威胁",
    "intent": "准备",
    "topic": "威胁",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: stealth
            target: 潜在威胁
            intent: 准备
            topic: 威胁
            risk: medium
            完整解析：{"action_type": "stealth", "target": "潜在威胁", "intent": "准备", "topic": "威胁", "risk": "medium"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：stealth
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：2

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 57, "magic_density": 86, "corruption": 23, "radiation": 5}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "准备好应对潜在威胁"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：no_information

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（stealth）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你小心地潜伏在阴影中，感到周围的紧张气氛。潜在的威胁似乎就在不远处，任何声音都可能揭示你的存在。你必须小心翼翼地准备应对突发情况。",
    "options": ["继续潜行", "寻找掩护", "静待观察"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：寻找掩护
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "stealth",
    "target": null,
    "intent": "移动",
    "topic": "掩护",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: stealth
            target: None
            intent: 移动
            topic: 掩护
            risk: medium
            完整解析：{"action_type": "stealth", "target": null, "intent": "移动", "topic": "掩护", "risk": "medium"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：stealth
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：2

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 59, "magic_density": 88, "corruption": 26, "radiation": 6}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "寻找掩护"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：no_information

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：2 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（stealth）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你轻声移动，尽量避免被周围的阴影发现。空气中弥漫着紧张的气息，任何细小的声音都可能暴露你的行踪。你能感受到身后潜藏的威胁，心跳加速，需小心行事。",
  "options": ["继续潜行", "寻找更好的掩护", "改变方向"],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续潜行
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "stealth",
    "target": null,
    "intent": "移动",
    "topic": null,
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: stealth
            target: None
            intent: 移动
            topic: None
            risk: medium
            完整解析：{"action_type": "stealth", "target": null, "intent": "移动", "topic": null, "risk": "medium"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：stealth
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：3

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 58, "magic_density": 90, "corruption": 26, "radiation": 7}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续潜行"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：no_information

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：3 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（stealth）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你小心翼翼地潜行在阴影中，紧张的气氛笼罩着四周。你能听到远处传来的低语声，似乎有其他生物正在观察着你，随时可能发现你的存在。",
    "options": ["继续潜行", "寻找安全的藏身之处", "观察周围环境"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：寻找安全的藏身之处
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "藏身之处",
    "intent": "调查",
    "topic": "安全",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 藏身之处
            intent: 调查
            topic: 安全
            risk: medium
            完整解析：{"action_type": "exploration", "target": "藏身之处", "intent": "调查", "topic": "安全", "risk": "medium"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：exploration
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：3

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 59, "magic_density": 91, "corruption": 25, "radiation": 9}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "寻找安全的藏身之处"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：3 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你在藏身之处调查时，发现四周的墙壁上布满了神秘的符文，发出微弱的光芒。地面有明显的爪痕，似乎是某种生物经过的迹象，空气中弥漫着一丝不安的气息。在进一步观察时，你听到了轻微的窸窣声，仿佛有什么东西在附近移动。",
  "options": [
    "继续调查符文",
    "追踪爪痕",
    "探索窸窣声的来源"
  ],
  "health_change": 0,
  "world_state_change": {
    "tension": 60
  },
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：追踪爪痕
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "爪痕",
    "intent": "调查",
    "topic": "爪痕",
    "risk": "medium"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 爪痕
            intent: 调查
            topic: 爪痕
            risk: medium
            完整解析：{"action_type": "exploration", "target": "爪痕", "intent": "调查", "topic": "爪痕", "risk": "medium"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：exploration
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：3

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 59, "magic_density": 91, "corruption": 26, "radiation": 12}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "追踪爪痕"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：3 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你仔细观察爪痕，发现它们不仅仅是表面的划痕，深处似乎隐藏着某种生物的特征。周围的空气中弥漫着一股异样的气味，让你感觉到一丝不安。地面上还有一些泥土被翻动的痕迹，可能指向某个方向。随着调查的深入，你能感受到这个地方的不寻常气氛。",
  "options": ["继续调查周围环境", "追踪爪痕的方向", "检查附近的其他线索"],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续调查周围环境
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": null,
    "intent": "调查",
    "topic": "环境",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: None
            intent: 调查
            topic: 环境
            risk: low
            完整解析：{"action_type": "exploration", "target": null, "intent": "调查", "topic": "环境", "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：exploration
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：3

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 60, "magic_density": 92, "corruption": 27, "radiation": 11}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续调查周围环境"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：3 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你仔细观察周围的环境，发现地面上有一些奇怪的足迹，似乎是一些不明生物留下的。你还听到了一种低沉的低语声，似乎从某个方向传来，令人不安。这个地方的气氛变得愈加紧迫，似乎隐藏着某些秘密。",
  "options": [
    "跟随足迹继续调查",
    "试图找到低语声的来源",
    "回到安全的地方",
    "仔细检查周围的环境"
  ],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：回到安全的地方
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "move",
    "target": null,
    "intent": "移动",
    "topic": "安全的地方",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: move
            target: None
            intent: 移动
            topic: 安全的地方
            risk: low
            完整解析：{"action_type": "move", "target": null, "intent": "移动", "topic": "安全的地方", "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：move
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：4

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 59, "magic_density": 91, "corruption": 26, "radiation": 14}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "回到安全的地方"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：no_information

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：4 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（move）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你成功地移动到了一个安全的地方，四周的环境显得宁静，阳光照耀着大地。这里有些树木和灌木，给你提供了一个遮蔽的场所。你感到放松，但也意识到需要决定接下来的动作。",
    "options": ["继续探索周围", "休息一会", "寻找食物"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：继续探索周围
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": null,
    "intent": "移动",
    "topic": null,
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: None
            intent: 移动
            topic: None
            risk: low
            完整解析：{"action_type": "exploration", "target": null, "intent": "移动", "topic": null, "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：exploration
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：4

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 57, "magic_density": 89, "corruption": 24, "radiation": 12}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "继续探索周围"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：4 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
  "dm_text": "你在周围环境中小心翼翼地探索，耳边传来微弱的水流声。你发现一处隐秘的洞口，洞口周围布满青苔，地面似乎有过动物经过的痕迹。这个地方散发着一丝神秘的气息，仿佛隐藏着某种秘密。",
  "options": ["调查洞口", "继续前进"],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    你是动作意图分析器。你的任务是把玩家输入解析成结构化行为。

    你只能输出 JSON，不要解释。

    JSON 模板：
    {
    "action_type": "combat | exploration | social | stealth | item | move",
    "target": "动作对象（如果有）",
    "intent": "意图（询问 / 调查 / 攻击 / 支援 / 移动 等）",
    "topic": "主题内容（女巫 / 水晶 / 魔法阵 等）",
    "risk": "low | medium | high"
    }

    规则：
    - action_type 必须从上述六种中选一个。
    - 若无法判断，则 action_type = "social"。
    

=== USER PROMPT ===
玩家行动：调查洞口
请输出结构化行为 JSON：

=== GPT RAW OUTPUT ===
{
    "action_type": "exploration",
    "target": "洞口",
    "intent": "调查",
    "topic": "洞口",
    "risk": "low"
}
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

            你是这个世界的 DM。你的事件必须遵守以下内容：

            ==================== 玩家行为（解析后，必须使用） ====================
            action_type: exploration
            target: 洞口
            intent: 调查
            topic: 洞口
            risk: low
            完整解析：{"action_type": "exploration", "target": "洞口", "intent": "调查", "topic": "洞口", "risk": "low"}

            ==================== ACTION 类型硬规则 ====================
            
            本回合事件类型是：exploration
            你必须完全按照该事件类型进行叙述。不得偏离。

            【combat】
            - 必须出现敌人或威胁
            - 必须有攻击/闪避/受伤
            - 必须体现 risk（风险）高低
            - 不得输出探索类线索，不得输出社交对话

            【exploration】
            - 必须出现调查行为
            - 必须发现“新的”线索（禁止重复 info_given）
            - 必须描述具体环境（地点结构/痕迹/声音）
            - 不得输出战斗，不得出现深层秘密

            【social】
            - 必须包含 NPC 对话（必须体现 speech_style）
            - 必须对应 target 的角色
            - 对话必须推动信息层级（shallow/medium/major）
            - 不得创建新角色

            【stealth】
            - 必须强调隐藏、侦察、紧张气氛
            - 必须有“被发现风险”
            - 不得给主线信息

            【item】
            - 必须描述一个具体物品
            - 必须提供关于物品的新用途或线索
            - 不得写战斗或社交

            【move】
            - 必须抵达一个具体地点
            - 必须描述抵达后的新状况
            - 必须提供新的行动方向
            - 不得写战斗、不写深线索
            

            ==================== 事件类型模板 ====================
            
            事件类型说明（你必须严格遵守 action_type）：

            1. combat（战斗事件）
            - 必须包含敌人、攻击、伤害、风险
            - 必须有至少一个战斗动作（攻击/格挡/躲闪）
            - 必须根据 risk 输出合适的危险程度描述

            2. exploration（探索事件）
            - 必须包含观察、调查、线索、发现
            - 必须给出新的信息，不得重复旧信息
            - 场景必须具体（地点结构、声音、痕迹）

            3. social（社交事件）
            - 必须包含对话、回应、情绪变化
            - target 若存在 → 必须与该角色互动
            - 必须推动剧情（不能只给氛围）

            4. stealth（潜行事件）
            - 必须出现潜伏、暗影、侦察、隐藏行为
            - 必须强调风险与隐蔽性

            5. item（物品事件）
            - 必须描述物品的细节、用途或秘密
            - 必须发现新的线索或产生新风险

            6. move（移动事件）
            - 必须描述新地点或环境变化
            - 必须给出抵达后的新状况与选择
            

            ==================== 章节规则（必须遵守） ====================
            
            当前章节：4

            你必须根据章节强制调整事件内容：

            0（序章）：
            - 只能给浅层信息
            - 冲突必须很轻
            - 不能出现重大秘密
            - 不得出现强敌

            1（线索阶段）：
            - exploration 必须给 medium 信息
            - social 必须给模糊但推进剧情的回答
            - move 必须引导到“关键地点”

            2（冲突阶段）：
            - exploration 必须给重大线索（major）
            - 环境必须危险化（更紧张）
            - social 必须体现情绪变化 trust/fear

            3（危机逼近）：
            - 必须出现紧迫感
            - 事件必须暗示终局
            - exploration 必须给关键信息碎片
            - social 必须出现 NPC 的恐惧或犹豫

            4（终章前夕）：
            - 必须出现核心秘密的 80% 线索
            - 气氛必须紧绷
            - 事件必须感觉到“马上要决战”

            5（最终章）：
            - 不再使用本事件模板
            - 最终章由终章 prompt 生成
            

            ==================== 世界状态（必须影响气氛） ====================
            {"tension": 55, "magic_density": 91, "corruption": 26, "radiation": 11}

            ==================== 玩家状态 ====================
            {"health": 100, "sanity": 90, "mana": 0, "custom": {"力量": 7, "敏捷": 9, "智力": 5}}

            ==================== NPC 性格约束（必须遵守） ====================
            每个 NPC 的个性如下，所有行为必须符合这些 personality：
            [{"name": "小白", "role": "探险者", "short_desc": "一只勇敢的小猫，热爱冒险，决心找到传说中的宝藏。", "stats": {"trust": 75, "fear": 20, "health": 100, "custom": {}}, "personality": {"traits": ["中性"], "speech_style": "正常语速、普通语气"}}, {"name": "黑夜", "role": "巫师", "short_desc": "一只神秘而强大的猫咪，掌握着古老的魔法，常常在阴影中观察。", "stats": {"trust": 31, "fear": 60, "health": 80, "custom": {}}, "personality": {"traits": ["神秘", "理性"], "speech_style": "语气平淡，带讲解性质"}}]

            NPC 规则：
            - traits 决定情绪底色（例如 冷静/冲动/神秘）
            - speech_style 决定说话方式（例如 短句/粗声/戏弄）
            - DM 在写 NPC 对话或动作时必须体现这些风格
            - DM 不得改变 NPC 性格，不得混淆不同角色的说话方式

            ==================== 玩家原始输入 ====================
            "调查洞口"

            ==================== 信息层级（你必须遵守） ====================
            本回合信息等级：major

            ==================== 已知信息（禁止重复） ====================
            这些线索已经给过，禁止重复解释：
            []

            信息规则：
            - shallow：只能给非常浅的线索，不得给任何关键秘密
            - medium：可以透露中等线索，但不得泄露最终真相
            - major：可以透露重大信息或剧情节点，但必须保留关键部分
            - deepening：玩家对同一 topic 的追问，只能给“更细节的补充”，禁止重复
            - reveal：主线已接近终点，可以揭露最重要的秘密
            - no_information：本回合不应提供剧情信息（例如战斗/移动/潜行）

            ==================== 当前剧情章节：4 ====================
            请严格按照该章节规则生成事件：

            # 0：序章（世界开场）
            - 主要任务：建立气氛、背景、初始冲突
            - 禁止透露任何核心秘密
            - 引导玩家认识角色与环境
            - 事件动作应该轻量（不激烈）

            # 1：线索阶段（推进）
            - 可以给浅层线索
            - 允许轻微冲突
            - NPC 回答必须含糊、保留
            - 不要透露幕后真相

            # 2：冲突阶段（重要）
            - 事件必须出现转折点或危险升级
            - 线索必须变得重要
            - NPC 关系必须有变化（trust/fear生效）
            - 环境也应变得紧张

            # 3：危机逼近（重大阶段）
            - 必须出现“大事件预兆”
            - 氛围明显变强
            - 玩家每个选择都显得重要
            - 可以揭示部分大秘密，但必须保留最终答案

            # 4：终章前夕（高潮前紧张）
            - 必须出现“逼近真相”的直接证据或关键事件
            - 冲突到达最高点
            - NPC 会表现出强烈情绪变化
            - 除非必要，禁止收尾事件

            # 5：最终章
            - 必须揭示全部真相
            - 结局必须完整
            - options 留空

            ==================== 事件类型与章节协同（必须遵守） ====================

            在本章节内，事件类型（exploration）必须服从章节目标。
            例如：
            - 序章的 combat 是小规模冲突
            - 冲突阶段的 exploration 要给出节点级线索
            - 危机逼近阶段的 social 必须带重大情绪变化
            - 终章前夕的所有事件都必须带有“临界点”意义

            ==================== 严格输出 JSON（不要旁白，不要解释） ====================
            结构如下：
            {
            "dm_text": "2~4句，必须体现 action_type 对事件的真实影响。",
            "options": ["基于 action_type 的行动选择"],
            "health_change": 整数,
            "world_state_change": {},
            "player_change": {},
            "npc_change": []
            }

            严格要求：
            - 不得输出与 action_type 无关的事件内容。
            - dm_text 必须体现玩家意图（intent）与目标（target）。
            - 不得重复旧信息（尤其是 topic 相关）。
            - options 必须与 action_type 对应。
            

=== GPT RAW OUTPUT ===
{
    "dm_text": "你仔细观察这个洞口，发现周围散落着一些奇怪的符文痕迹，似乎在传达着某种信息。洞口发出低沉的回声，仿佛在警告你靠近的危险。悉心调查后，你找到了一块闪烁着微光的石头，似乎与洞口的秘密息息相关。",
    "options": ["进一步调查符文", "检查闪烁的石头", "离开洞口"],
    "health_change": 0,
    "world_state_change": {},
    "player_change": {},
    "npc_change": []
}
==================================================


==================== HEALTH CHANGE ====================
100
==================================================


==================== NEW CALL ====================
=== SYSTEM PROMPT ===

    You are a state machine. 
    Your ONLY job is to output strict JSON based on a template.
    You MUST NOT output narrative, only fill JSON fields.
    Never add any text outside the JSON.
    IMPORTANT FAILSAFE (必须执行):
    If your output violates ANY rule above — including:
    - wrong event_type behavior,
    - wrong chapter behavior,
    - repeating a clue already in info_given,
    - creating new lore not supported by the world,
    - giving information deeper than allowed by info_level,
    - not using npc personality traits/speech_style,
    - including narrative outside JSON,
    - including explanations or apologies,
    - generating options that do not match action_type,

    Then you MUST discard the attempt and regenerate a CORRECT version.
    Only output strict JSON that follows ALL rules.
    Never output meta comments.
    

=== USER PROMPT ===

                你是这个世界的 DM。主线任务已经达成，请生成【终章事件】。

                要求：
                - 叙事 4~6 句
                - 汇总此前所有重要线索（NPC、黑暗力量、水晶、魔法阵）
                - 给出世界最终结局（胜利 / 失败 / 牺牲 / 未知）
                - 氛围必须符合当前 world_state
                - 不要再提供 options（冒险结束）
                - 输出严格 JSON：

                你必须基于以下内容生成终章：

                - adventure_history（最近 6 回合）
                - memory.info_given（所有已给过的线索）
                - world.main_quest（主线）
                - world.locations（合法地点）
                - world.characters（合法角色）

                {
                "dm_text": "最终剧情",
                "options": [],
                "health_change": 0,
                "world_state_change": {},
                "player_change": {},
                "npc_change": []
                }
                

=== GPT RAW OUTPUT ===
{
  "dm_text": "",
  "options": [],
  "health_change": 0,
  "world_state_change": {},
  "player_change": {},
  "npc_change": []
}
==================================================
